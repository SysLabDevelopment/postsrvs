(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{SdKL:function(t,n,e){"use strict";e.r(n),e.d(n,"CourierPageModule",(function(){return at}));var o=e("ltgo"),i=e("7KAL"),s=e("SVse"),r=e("wq8c"),c=e.n(r),a=e("8Y7J"),b=e("s7LF"),l=e("iInd"),d=e("sZkV"),u=e("sbs8"),h=e("mrSG"),g=e("GS7A"),p=e("zA0m"),f=e("hnS/"),m=e("xoVG"),_=e("/hfl"),C=e("XNiG"),M=e("1G5W"),w=e("lJxs"),O=e("D279"),P=e("dKCF");let v=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=a.Cb({type:t,selectors:[["app-help"]],decls:16,vars:0,consts:[[1,"body"],[1,"title"],["lines","none"],["name","ellipsis-vertical","slot","start"],["src","../../../assets/show-actions-helper.svg","slot","start"],["name","search","slot","start"]],template:function(t,n){1&t&&(a.Lb(0,"div",0),a.Lb(1,"h5",1),a.rc(2,"\u041f\u043e\u043c\u043e\u0449\u044c"),a.Kb(),a.Lb(3,"ion-list"),a.Lb(4,"ion-item",2),a.Jb(5,"ion-icon",3),a.Lb(6,"ion-label"),a.rc(7,"\u0414\u043b\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0437\u0430\u0436\u043c\u0438\u0442\u0435 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435"),a.Kb(),a.Kb(),a.Lb(8,"ion-item",2),a.Jb(9,"ion-icon",4),a.Lb(10,"ion-label"),a.rc(11,"\u0427\u0442\u043e\u0431\u044b \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u043f.\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0437\u0430\u043a\u0430\u0437\u0430 \u043a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043d\u0430 \u0437\u0430\u043a\u0430\u0437 \u0434\u0432\u0430\u0436\u0434\u044b \u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u0433\u043e\u043b\u0443\u0431\u0443\u044e \u043a\u043d\u043e\u043f\u043a\u0443"),a.Kb(),a.Kb(),a.Lb(12,"ion-item",2),a.Jb(13,"ion-icon",5),a.Lb(14,"ion-label"),a.rc(15,"\u0427\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u0437\u0430\u043a\u0430\u0437 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443,\u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0438\u043b\u0438 \u0430\u0434\u0440\u0435\u0441\u0443, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0443\u0436\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043f\u043e\u0438\u0441\u043a\u0435 \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0430\u043c"),a.Kb(),a.Kb(),a.Kb(),a.Kb())},directives:[d.o,d.m,d.k,d.n],styles:[".body[_ngcontent-%COMP%]{padding:8px 10px 10px 13px}.body[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#2b637e;font-size:14px;font-weight:700}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start:0}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 5px 0 0;font-size:3em}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:12px;white-space:normal}"]}),t})();var L=e("1tbR");let k=(()=>{class t{constructor(t,n){this.sysMap=t,this.viewCtrl=n}ngOnInit(){this.note=localStorage.getItem(this.orderId)}saveNote(){localStorage.setItem(this.orderId,this.note),this.sysMap.infoUpdated.next(),this.viewCtrl.dismiss()}}return t.\u0275fac=function(n){return new(n||t)(a.Ib(O.a),a.Ib(d.H))},t.\u0275cmp=a.Cb({type:t,selectors:[["app-note"]],inputs:{orderId:"orderId"},decls:4,vars:1,consts:[["placeholder","\u0412\u0430\u0448\u0430 \u0437\u0430\u043c\u0435\u0442\u043a\u0430 \u043e \u0437\u0430\u043a\u0430\u0437\u0435",3,"ngModel","ngModelChange"],[3,"click"],["name","save"]],template:function(t,n){1&t&&(a.Lb(0,"ion-item"),a.Lb(1,"ion-textarea",0),a.Tb("ngModelChange",(function(t){return n.note=t})),a.Kb(),a.Kb(),a.Lb(2,"ion-button",1),a.Tb("click",(function(){return n.saveNote()})),a.Jb(3,"i-feather",2),a.Kb()),2&t&&(a.yb(1),a.cc("ngModel",n.note))},directives:[d.m,d.A,d.K,b.f,b.g,d.e,L.a],styles:[""],changeDetection:0}),t})();var y=e("lGQG"),I=e("24R0"),x=e("6nr9"),K=e("ndxW"),V=e("tudd"),S=e("X5X/");const D=["sInput"];function T(t,n){1&t&&(a.Lb(0,"ion-button"),a.Lb(1,"i"),a.rc(2,"G"),a.Kb(),a.Kb())}function $(t,n){if(1&t){const t=a.Mb();a.Lb(0,"ion-button",2),a.Tb("click",(function(){return a.lc(t),a.Vb().submitOrder()})),a.Jb(1,"i-feather",22),a.Kb()}}function j(t,n){if(1&t){const t=a.Mb();a.Lb(0,"ion-button",2),a.Tb("click",(function(){return a.lc(t),a.Vb().endWork()})),a.Jb(1,"i-feather",23),a.Kb()}}function q(t,n){if(1&t&&(a.Lb(0,"span"),a.rc(1),a.Wb(2,"date"),a.Kb()),2&t){const t=a.Vb().$implicit;a.yb(1),a.tc("c ",a.Zb(2,1,t.datetime_from,"H:mm","ru")," ")}}function R(t,n){if(1&t&&(a.Lb(0,"span"),a.rc(1),a.Wb(2,"date"),a.Kb()),2&t){const t=a.Vb().$implicit;a.yb(1),a.tc("\u0434\u043e ",a.Zb(2,1,t.datetime_to,"H:mm","ru"),"")}}function J(t,n){if(1&t){const t=a.Mb();a.Lb(0,"div",37),a.Lb(1,"ion-button",38),a.Tb("click",(function(n){a.lc(t);const e=a.Vb().$implicit;return a.Vb(2).note(n,e.id),n.stopPropagation()})),a.Jb(2,"ion-icon",39),a.rc(3," \u0417\u0430\u043c\u0435\u0442\u043a\u0438 "),a.Kb(),a.Lb(4,"ion-button",38),a.Tb("click",(function(n){a.lc(t);const e=a.Vb().$implicit;return a.Vb(2).showRoute(e),n.stopPropagation()})),a.Jb(5,"ion-icon",40),a.rc(6," \u041c\u0430\u0440\u0448\u0440\u0443\u0442 "),a.Kb(),a.Lb(7,"ion-button",38),a.Tb("click",(function(n){a.lc(t);const e=a.Vb().$implicit;return a.Vb(2).phoneClick("init",e),n.stopPropagation()})),a.Jb(8,"ion-icon",41),a.rc(9," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c "),a.Kb(),a.Kb()}}const W=function(t){return{overdue:t}},z=function(t){return{turned:t}};function E(t,n){if(1&t){const t=a.Mb();a.Lb(0,"ion-item",28),a.Tb("click",(function(){a.lc(t);const e=n.$implicit;return a.Vb(2).selectOrder(e.id)}))("longPress",(function(){return a.lc(t),a.Vb(2).vibr()}))("hold",(function(){return a.lc(t),a.Vb(2).vibr()}))("cdkDragStarted",(function(){return a.lc(t),a.Vb(2).vibr()})),a.Lb(1,"ion-label"),a.Lb(2,"div",29),a.Lb(3,"span"),a.Lb(4,"span",30),a.rc(5),a.Kb(),a.Lb(6,"span"),a.rc(7),a.Kb(),a.Kb(),a.Lb(8,"span",30),a.qc(9,q,3,5,"span",4),a.qc(10,R,3,5,"span",4),a.Kb(),a.Kb(),a.Lb(11,"div",31),a.rc(12),a.Kb(),a.Lb(13,"div",32),a.rc(14),a.Kb(),a.qc(15,J,10,0,"div",33),a.Kb(),a.Jb(16,"ion-icon",34),a.Lb(17,"div",35),a.Tb("click",(function(e){a.lc(t);const o=n.$implicit;return o.show=!o.show,e.stopPropagation()})),a.Jb(18,"ion-icon",36),a.Kb(),a.Kb()}if(2&t){const t=n.$implicit,e=a.Vb(2);a.cc("ngClass",a.fc(12,W,"1"==t.overdue||1==t.required))("cdkDragStartDelay",500)("cdkDragDisabled",e.noDrag),a.yb(1),a.cc("@openClose",t.show?"open":"closed"),a.yb(4),a.tc(" ",t.client_id,""),a.yb(2),a.tc(" (",t.company,")"),a.yb(2),a.cc("ngIf",t.datetime_from),a.yb(1),a.cc("ngIf",t.datetime_to),a.yb(2),a.sc(t.client_address),a.yb(2),a.sc(t.client_fio),a.yb(1),a.cc("ngIf",t.show),a.yb(3),a.cc("ngClass",a.fc(14,z,1==t.show))}}function A(t,n){if(1&t){const t=a.Mb();a.Lb(0,"div",24),a.Lb(1,"ion-searchbar",25),a.Tb("ionChange",(function(n){return a.lc(t),a.Vb().onSearchChange(n)}))("ngModelChange",(function(n){return a.lc(t),a.Vb().searchString=n})),a.Kb(),a.Lb(2,"cdk-virtual-scroll-viewport",26),a.Tb("cdkDropListDropped",(function(n){return a.lc(t),a.Vb().drop(n)})),a.qc(3,E,19,16,"ion-item",27),a.Wb(4,"async"),a.Kb(),a.Kb()}if(2&t){const t=a.Vb();a.yb(1),a.cc("debounce",250)("ngModel",t.searchString),a.yb(2),a.cc("ngForOf",a.Xb(4,3,t.orders_c))}}function N(t,n){if(1&t){const t=a.Mb();a.Lb(0,"button",46),a.Tb("click",(function(){return a.lc(t),a.Vb(2).startRoute()})),a.rc(1," \u041d\u0430\u0447\u0430\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442 "),a.Kb()}}function G(t,n){if(1&t){const t=a.Mb();a.Lb(0,"button",47),a.Tb("click",(function(){return a.lc(t),a.Vb(2).stopRoute()})),a.rc(1," \u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442 "),a.Kb()}}function H(t,n){1&t&&(a.Lb(0,"span"),a.rc(1,"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"),a.Kb())}function F(t,n){1&t&&(a.Lb(0,"span"),a.rc(1,"\u0420\u0443\u0447\u043d\u043e\u0439 \u0440\u0435\u0436\u0438\u043c"),a.Kb())}const B=function(t){return{manual_btn:t}};function U(t,n){if(1&t){const t=a.Mb();a.Lb(0,"button",48),a.Tb("click",(function(){return a.lc(t),a.Vb(2).manualRoute()})),a.qc(1,H,2,0,"span",4),a.qc(2,F,2,0,"span",4),a.Kb()}if(2&t){const t=a.Vb(2);a.cc("ngClass",a.fc(3,B,t.state$.manual_route)),a.yb(1),a.cc("ngIf",t.state$.manual_route),a.yb(1),a.cc("ngIf",!t.state$.manual_route)}}function X(t,n){if(1&t&&(a.Lb(0,"div",42),a.qc(1,N,2,0,"button",43),a.qc(2,G,2,0,"button",44),a.qc(3,U,3,5,"button",45),a.Kb()),2&t){const t=a.Vb();a.yb(1),a.cc("ngIf",!t.btn_go&&!t.state$.manual_route&&t.auth.routingModeAuto),a.yb(1),a.cc("ngIf",t.btn_go&&!t.state$.manual_route),a.yb(1),a.cc("ngIf","auto"==t.auth.getMode()||"auto_wo"==t.auth.getMode())}}function Z(t,n){if(1&t){const t=a.Mb();a.Lb(0,"div",49),a.Lb(1,"div",50),a.Lb(2,"div",51),a.rc(3,"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 \u0448\u0442\u0440\u0438\u0445\u043a\u043e\u0434"),a.Kb(),a.Lb(4,"input",52,53),a.Tb("change",(function(){return a.lc(t),a.Vb().scanInputChange()}))("ngModelChange",(function(n){return a.lc(t),a.Vb().scanInput=n})),a.Kb(),a.Kb(),a.Kb()}if(2&t){const t=a.Vb();a.yb(4),a.cc("ngModel",t.scanInput)}}function Q(t,n){1&t&&(a.Lb(0,"div",54),a.Jb(1,"ion-spinner",55),a.Kb())}function Y(t,n){if(1&t&&(a.Lb(0,"ion-item"),a.Jb(1,"ion-radio",61),a.Lb(2,"ion-label"),a.rc(3),a.Kb(),a.Kb()),2&t){const t=n.$implicit;a.yb(1),a.dc("value",t),a.yb(2),a.sc(t)}}function tt(t,n){if(1&t){const t=a.Mb();a.Lb(0,"ion-list"),a.Lb(1,"ion-radio-group",59),a.Tb("ngModelChange",(function(n){return a.lc(t),a.Vb(2).selectedPhone=n})),a.Lb(2,"ion-list-header"),a.Lb(3,"ion-label"),a.rc(4,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440"),a.Kb(),a.Kb(),a.qc(5,Y,4,2,"ion-item",60),a.Kb(),a.Kb()}if(2&t){const t=a.Vb(2);a.yb(1),a.cc("ngModel",t.selectedPhone),a.yb(4),a.cc("ngForOf",t.orderPhones)}}function nt(t,n){if(1&t){const t=a.Mb();a.Lb(0,"button",2),a.Tb("click",(function(){a.lc(t);const n=a.Vb(2);return n.phoneClick("phone",n.order)})),a.rc(1," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0441\u043e \u0441\u0432\u043e\u0435\u0433\u043e \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 "),a.Kb()}}function et(t,n){if(1&t){const t=a.Mb();a.Lb(0,"button",2),a.Tb("click",(function(){a.lc(t);const n=a.Vb(2);return n.phoneClick("operator",n.order)})),a.rc(1," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 ip-\u0448\u043b\u044e\u0437 "),a.Kb()}}function ot(t,n){if(1&t){const t=a.Mb();a.Lb(0,"div",56),a.Lb(1,"div",57),a.Lb(2,"i-feather",58),a.Tb("click",(function(){a.lc(t);const n=a.Vb();return n.callWindow=!n.callWindow})),a.Kb(),a.qc(3,tt,6,2,"ion-list",4),a.qc(4,nt,2,0,"button",8),a.qc(5,et,2,0,"button",8),a.Kb(),a.Kb()}if(2&t){const t=a.Vb();a.yb(3),a.cc("ngIf",t.orderPhones.length>1),a.yb(1),a.cc("ngIf","robotPhone"==t.settings.rules.phoneMode||"phone"==t.settings.rules.phoneMode),a.yb(1),a.cc("ngIf","robotPhone"==t.settings.rules.phoneMode||"robot"==t.settings.rules.phoneMode)}}const it=function(t){return{m_wrp:t}},st=function(){return[]};let rt=(()=>{class t{constructor(t,n,e,o,i,s,r,c,a,b,l,d,u,h){this.courier=t,this.router=n,this.state$=e,this.auth=o,this.bs=i,this.vbr=s,this.settings=r,this.sys=c,this.data=a,this.popoverController=b,this.map=l,this.orderService=d,this.CL=u,this.network=h,this.orders=null,this.statuses=null,this.selectedTab=1,this.ordersInit=!1,this.loader=!1,this.local_stop$=new C.a,this.localcheck=!1,this.g_done=0,this.g_process=0,this.g_fail=0,this.lvl_ind={width:"0%"},this.btn_go=!1,this.notification=null,this.subBtnCond=!0,this.scanView=!1,this.scan_process=!1,this.find_order=!1,this.isWorkEnded=!1,this.searchString="",this.slicer=this.howSlice(),this.callWindow=!1,this.noDrag=!1;let g=this;this.initContent(),null!=this.state$.position.getValue()&&this.startRoute(!1),this.state$.state.pipe(Object(M.a)(this.local_stop$)).subscribe(t=>{"orders_init"==t&&g.initContent()}),this.initConditions(),this.ord=this.data.orders.asObservable(),this.prepareOrdersList()}initConditions(){switch(this.auth.getMode()){case"fullAuto":this.state$.confirmed||(this.subBtnCond=!0);break;case"auto":this.subBtnCond=!1;break;case"fullHand":this.state$.confirmed||(this.subBtnCond=!0);break;case"hand":this.subBtnCond=!1}}ngAfterViewChecked(){this.Drop_L.autoScrollDisabled=!1,this.DragItems.changes.subscribe(t=>{this.DragItems.forEach(t=>{t.dragStartDelay={touch:500,mouse:100}})})}ngOnInit(){this.settings.checkout=!!(this.settings.rules.storeCheckMode-0),this.auth.checkState=this.settings.checkout?"checked"+localStorage.check:"checkedOut","hand"==this.settings.rules.appMode&&(this.state$.manual_route=!0),this.settings.rules.appMode.toLowerCase().includes("auto")&&(this.noDrag=!0),this.data.orders.subscribe(t=>{this.courier.count_orders(t)})}scanInputStart(){let t=this;this.scanView=!this.scanView,this.loader=!0,"scan"==this.auth.getScanMode()?t.courier.findOrder(this.scanInput).subscribe(n=>{t.scanInput=null,"true"==n.success?t.courier.sumbitOrder(n.order_id).subscribe(n=>{console.log("courier_page sbo resp",n),n?t.submitOrder():t.scanView=!1,t.loader=!1}):(t.auth.showError(2),t.loader=!1,t.scanView=!1),t.state$.confirmed=!0,t.orders.forEach(n=>{"0"==n.confirm&&(t.state$.confirmed=!1)})}):t.loader=!1,this.scan_process=!1}scanInputChange(){console.log("inputData",this.scanInput);let t=this;if(this.scan_process)return!1;this.scan_process=!0,this.find_order?setTimeout((function(){t.scanSearch()}),1500):setTimeout((function(){t.scanInputStart()}),1500)}submitOrder(){var t=this;if(console.log("SUBMIT_ORDER_CALL"),"scan"==this.auth.getScanMode())return this.scanView=!this.scanView,setTimeout((function(){t.sInput.nativeElement.focus()}),500),!1;this.bs.scan().then(n=>{console.log("SCAN_RETURN_DATA",n),""!=n.text?(t.loader=!0,t.courier.findOrder(n.text).subscribe(n=>{"true"==n.success?t.courier.sumbitOrder(n.order_id).subscribe(n=>{n&&t.submitOrder(),t.loader=!1}):(t.auth.showError(2),t.loader=!1),t.state$.confirmed=!0,t.orders.forEach(n=>{"0"==n.confirm&&(t.state$.confirmed=!1)})})):t.loader=!1})}ordersListChanged(t){this.orders=t;let n=new Array;t.forEach(t=>{1==Number(t.status_id)&&n.push(t.id)}),this.state$.old_way=n}ngOnDestroy(){this.local_stop$.next(),this.state$.orders_page_check=!1}manualRoute(){this.courier.changeRouteMode(this.state$.manual_route?"auto":"fullHand"),this.vbr.vibrate(300)}initContent(){var t=this;this.state$.orders.subscribe(()=>{this.orders=this.state$.orders_data,console.log("sys::init\u0421ontent orders",this.orders),this.statuses=[{id:4,status:"\u041d\u0435 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"},{id:5,status:"\u0414\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"},{id:6,status:"\u0427\u0430\u0441\u0442\u0438\u0447\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"}],this.ordersInit=!0,t.count_orders()})}getStatus(t){return this.courier.getStatus(t)}selectOrder(t){this.router.navigate(["/order",t])}tabSelect(t){this.selectedTab=t}customTrackBy(t,n){return t}getCondition(t){switch(this.selectedTab){case 1:if(1==t)return!0;break;case 2:if(5==t||6==t)return!0;break;case 3:if(4==t)return!0}return!1}count_orders(t=this.courier.ordersInfo){let n=0,e=0,o=0;for(let i=0;i<t.length;i++)switch(String(t[i].status_id)){case"4":o++;break;case"5":case"6":n++;break;case"1":e++}this.g_done=n,this.g_process=e,this.g_fail=o}startRoute(t=!0,n=!1){let e=this;this.auth.checkAuth().subscribe(o=>{"true"==o.success&&e.sendStartRoute(o.sync_id,t,n)})}stopRoute(){this.startRoute(!1,!0)}sendStartRoute(t,n,e){let o={cid:t,lt:this.state$.position.getValue().lt,lg:this.state$.position.getValue().lg};n&&(o.start="1"),e&&(o.stop="1");let i=this;this.auth.sendPost("geo/route_start.php",o).subscribe(t=>{1==t.success&&(i.btn_go=!0,"stop"==t.result&&(i.btn_go=!1))})}scanSearch(){let t=this;this.scanView=!this.scanView,this.loader=!0,"scan"==this.auth.getScanMode()?t.courier.findOrder(this.scanInput).subscribe(n=>{t.scanInput=null,"true"==n.success?t.selectOrder(n.order_id):t.auth.showError(2),t.loader=!1,t.scanView=!1}):t.loader=!1,this.scan_process=!1,this.find_order=!1}findOrder(){let t=this;if("scan"==this.auth.getScanMode())return this.scanView=!this.scanView,this.find_order=!0,setTimeout((function(){t.sInput.nativeElement.focus()}),500),!1;this.bs.scan().then(n=>{t.courier.findOrder(n.text).subscribe(n=>{"true"==n.success?t.selectOrder(n.order_id):t.auth.showError(2)})})}endWork(){this.courier.endWork().subscribe(t=>{t.success&&(this.isWorkEnded=!0,this.sys.presentToast("\u0420\u0430\u0431\u043e\u0447\u0438\u0439 \u0434\u0435\u043d\u044c \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d","success"))},t=>{this.sys.presentToast("\u041e\u0448\u0438\u0431\u043a\u0430: "+t.message,"danger")})}doRefresh(t){this.data.getApiData().add(t.target.complete())}segmentChanged(t){let n=[Number(t.target.value)];"4"==t.target.value&&n.push(5),this.prepareOrdersList(n)}onSearchChange(t){}prepareOrdersList(t=[1]){this.orders_c=this.ord.pipe(Object(w.a)(n=>n&&n.filter(n=>t.includes(Number(n.status_id))).filter(t=>t.client_address.toLowerCase().includes(this.searchString.toLowerCase())||t.client_fio.toLowerCase().includes(this.searchString.toLowerCase())||t.client_id.toLowerCase().includes(this.searchString.toLowerCase())).slice(this.slicer)),Object(w.a)(t=>(t.forEach(t=>{t.show=!1}),this.orders=t,t)))}howSlice(){return"standart"===this.settings.rules.typeRoute?0:1}popoverHelp(t){return Object(h.a)(this,void 0,void 0,(function*(){return yield this.popoverController.create({component:v,event:t,translucent:!0,cssClass:"help"})}))}showHelp(t){return Object(h.a)(this,void 0,void 0,(function*(){(yield this.popoverHelp(t)).present()}))}showRoute(t){this.map.showRoute(t)}drop(t){Object(o.d)(this.orders,t.previousIndex,t.currentIndex),this.data.orders.next(this.orders),console.log("sys:: \u043c\u0430\u0441\u0441\u0438\u0432 \u0437\u0430\u043a\u0430\u0437\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u044f: ",this.orders)}popoverNote(t,n){return Object(h.a)(this,void 0,void 0,(function*(){return yield this.popoverController.create({component:k,event:t,translucent:!0,cssClass:"help",componentProps:{orderId:n}})}))}note(t,n){return Object(h.a)(this,void 0,void 0,(function*(){(yield this.popoverNote(t,n)).present()}))}phoneClick(t,n){this.order=n,this.orderPhones=this.parsePhone(n.client_phone);let e=this.parsePhone(n.courier_phone)[0];switch(1==this.orderPhones.length&&(this.selectedPhone=this.orderPhones[0]),t){case"init":this.callWindow=!this.callWindow;break;case"phone":this.CL.callNumber(this.selectedPhone,!1).then(()=>{}),this.callWindow=!1,this.order=void 0;break;case"operator":if("none"==this.network.type)return this.phoneClick("phone",n),!1;this.selectedPhone&&e&&(this.auth.sendPost("orders",{action:"send_phone",client_number:this.selectedPhone,cur_number:e}).subscribe(t=>{console.log("call_subs",t)}),this.auth.showError(9),this.callWindow=!1),this.order=void 0}}parsePhone(t){let n=[];for(t=t.replace(/\D+/g,"");t.length>7;)t=this.normalizePhoneNumber(t),n.push(t.slice("",11)),t=t.slice(11);return n}normalizePhoneNumber(t){return"8"!==t[0]&&"7"!==t[0]&&11!==t.length&&(t="8"+t),7!=t.length&&10!=t.length||(t="8"+t),"8"!==t[0]&&11==t.length&&(t="8"+t.slice(1)),t}vibr(t){this.vbr.vibrate(200),console.log("sys:: *\u0412\u0438\u0431\u0438\u0440\u0430\u0446\u0438\u044f*")}}return t.\u0275fac=function(n){return new(n||t)(a.Ib(I.a),a.Ib(l.g),a.Ib(K.a),a.Ib(y.a),a.Ib(p.a),a.Ib(_.a),a.Ib(x.a),a.Ib(V.a),a.Ib(S.a),a.Ib(d.H),a.Ib(O.a),a.Ib(P.a),a.Ib(f.a),a.Ib(m.a))},t.\u0275cmp=a.Cb({type:t,selectors:[["app-courier"]],viewQuery:function(t,n){var e;1&t&&(a.vc(D,!0),a.vc(o.b,!0),a.vc(o.a,!0)),2&t&&(a.jc(e=a.Ub())&&(n.sInput=e.first),a.jc(e=a.Ub())&&(n.Drop_L=e.first),a.jc(e=a.Ub())&&(n.DragItems=e))},decls:34,vars:13,consts:[[1,"toolbar"],["slot","start"],[3,"click"],["name","search","slot","start"],[4,"ngIf"],["appLongPress","",3,"longPress"],["size","small","color","dark"],["slot","primary"],[3,"click",4,"ngIf"],["slot","icon-only","name","help-circle-outline"],["slot","fixed",3,"ionRefresh"],["pullingIcon","arrow-dropdown","pullingText","\u041f\u043e\u0442\u044f\u043d\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c","refreshingSpinner","bubbles","refreshingText","\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435..."],[1,"c-wrp",3,"ngClass"],["value","1",2,"height","45px",3,"ionChange"],["value","1"],["value","4"],["value","6"],["class","c-body",4,"ngIf"],["class","start-route",4,"ngIf"],["class","scanWindow",4,"ngIf"],["class","shirm",4,"ngIf"],["class","call-window",4,"ngIf"],["name","box"],["name","check-square"],[1,"c-body"],["placeholder","\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0430\u043c","inputmode","text","animated","",3,"debounce","ngModel","ionChange","ngModelChange"],["cdkDropList","","itemSize","50",2,"height","100%","width","100%","min-height","50vh",3,"cdkDropListDropped"],["appLongPress","","cdkDrag","",3,"ngClass","cdkDragStartDelay","cdkDragDisabled","click","longPress","hold","cdkDragStarted",4,"ngFor","ngForOf"],["appLongPress","","cdkDrag","",3,"ngClass","cdkDragStartDelay","cdkDragDisabled","click","longPress","hold","cdkDragStarted"],[1,"title"],[1,"client-id"],[1,"addr"],[1,"name"],["class","actions",4,"ngIf"],["name","ellipsis-vertical","slot","start"],[1,"actions-button",3,"click"],["src","../../../assets/actions-arrows.svg",3,"ngClass"],[1,"actions"],["fill","solid","size","default",3,"click"],["slot","start","src","../../../assets/mdi-light_note-plus.svg"],["slot","start","name","location-outline"],["slot","start","name","call-outline"],[1,"start-route"],["class","satrt-r-btn",3,"click",4,"ngIf"],["class","satrt-r-btn sr-stop",3,"click",4,"ngIf"],["class","satrt-r-btn find-o-btn",3,"ngClass","click",4,"ngIf"],[1,"satrt-r-btn",3,"click"],[1,"satrt-r-btn","sr-stop",3,"click"],[1,"satrt-r-btn","find-o-btn",3,"ngClass","click"],[1,"scanWindow"],[1,"sw-wrp"],[1,"sw-title"],["autofocus","",1,"ionInp",3,"ngModel","change","ngModelChange"],["sInput",""],[1,"shirm"],["name","lines-small"],[1,"call-window"],[1,"cw-body"],["name","x-square","size","large",3,"click"],["name","selectedPhone",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){1&t&&(a.Lb(0,"ion-header"),a.Lb(1,"ion-toolbar",0),a.Lb(2,"ion-buttons",1),a.Lb(3,"ion-button",2),a.Tb("click",(function(){return n.findOrder()})),a.Jb(4,"i-feather",3),a.Kb(),a.qc(5,T,3,0,"ion-button",4),a.Kb(),a.Lb(6,"ion-title",5),a.Tb("longPress",(function(){return n.vibr()})),a.rc(7,"\u041c\u043e\u0438 \u0437\u0430\u043a\u0430\u0437\u044b"),a.Kb(),a.Lb(8,"ion-title",6),a.rc(9),a.Kb(),a.Lb(10,"ion-buttons",7),a.qc(11,$,2,0,"ion-button",8),a.qc(12,j,2,0,"ion-button",8),a.Lb(13,"ion-button",2),a.Tb("click",(function(t){return n.showHelp(t)})),a.Jb(14,"ion-icon",9),a.Kb(),a.Kb(),a.Kb(),a.Kb(),a.Lb(15,"ion-content"),a.Lb(16,"ion-refresher",10),a.Tb("ionRefresh",(function(t){return n.doRefresh(t)})),a.Jb(17,"ion-refresher-content",11),a.Kb(),a.Lb(18,"div",12),a.Lb(19,"ion-segment",13),a.Tb("ionChange",(function(t){return n.segmentChanged(t)})),a.Lb(20,"ion-segment-button",14),a.Lb(21,"ion-label"),a.rc(22,"\u0412 \u0440\u0430\u0431\u043e\u0442\u0435"),a.Kb(),a.Kb(),a.Lb(23,"ion-segment-button",15),a.Lb(24,"ion-label"),a.rc(25,"\u0414\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"),a.Kb(),a.Kb(),a.Lb(26,"ion-segment-button",16),a.Lb(27,"ion-label"),a.rc(28,"\u041d\u0435 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"),a.Kb(),a.Kb(),a.Kb(),a.qc(29,A,5,5,"div",17),a.qc(30,X,4,3,"div",18),a.qc(31,Z,6,1,"div",19),a.Kb(),a.qc(32,Q,2,0,"div",20),a.qc(33,ot,6,3,"div",21),a.Kb()),2&t&&(a.yb(5),a.cc("ngIf",n.auth.getGuessMode()),a.yb(4),a.sc(n.state$.filial),a.yb(2),a.cc("ngIf",n.subBtnCond),a.yb(1),a.cc("ngIf",0==(null==n.courier.sortOrders?null:n.courier.sortOrders.g_process)&&!n.isWorkEnded),a.yb(6),a.cc("ngClass",a.fc(10,it,"fullHand"==n.auth.getMode()||"hand"==n.auth.getMode())),a.yb(11),a.cc("ngIf",n.ordersInit&&!n.auth.getGuessMode()),a.yb(1),a.cc("ngIf",n.ordersInit&&n.state$.orders_data!=a.ec(12,st)&&null!==n.state$.orders_data&&"checkedOut"==n.auth.checkState),a.yb(1),a.cc("ngIf",n.scanView),a.yb(1),a.cc("ngIf",n.loader),a.yb(1),a.cc("ngIf",n.callWindow))},directives:[d.j,d.C,d.f,d.e,L.a,s.l,d.B,d.k,d.h,d.s,d.t,s.j,d.w,d.J,d.x,d.n,d.v,d.K,b.f,b.g,i.c,i.a,o.b,s.k,d.m,o.a,b.a,d.y,d.o,d.r,d.p,d.q,d.I],pipes:[s.b,s.e],styles:["ion-chip[_ngcontent-%COMP%]{white-space:nowrap}.headbar-right-buttons[_ngcontent-%COMP%]{position:fixed;right:0;z-index:999999;top:0;display:flex}ion-toolbar[_ngcontent-%COMP%]{--min-height:30px}.toolbar[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{font-size:16px}ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:30px}ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.fether[_ngcontent-%COMP%]{height:16px}ion-segment[_ngcontent-%COMP%]{height:45 px}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background:#e5f0f4;--border-style:solid;--border-width:0.5px;--color:#585454;--color-checked:#2b637e;--indicator-height:0}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{text-transform:none}ion-searchbar[_ngcontent-%COMP%]{--box-shadow:0 0 01px #000}ion-item[_ngcontent-%COMP%]{--border-color:#d6cfcf;--border-width:1px;--border-radius:2px;--padding-start:0;margin:0 2px 5px}ion-item[_ngcontent-%COMP%]   ion-reorder[_ngcontent-%COMP%]{margin:8px 2px 5px}ion-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;font-size:14px}ion-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .client-id[_ngcontent-%COMP%]{color:#2b637e}ion-item[_ngcontent-%COMP%]   .addr[_ngcontent-%COMP%]{color:#585454;font-size:13px;white-space:pre-wrap;padding:5px 0}ion-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{color:#333;font-size:13px;font-weight:700}ion-item[_ngcontent-%COMP%]   .actions-button[_ngcontent-%COMP%]{background:#4ba7c5;box-shadow:-1px -1px 2px rgba(0,0,0,.05);border-radius:10px 0 2px;position:absolute;right:0;bottom:0;width:25px;height:35px;text-align:center}ion-item[_ngcontent-%COMP%]   .actions-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:50% 0;width:12px;height:12px}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{position:absolute;bottom:0}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background:#2b637e;--border-radius:4px;font-size:12px;text-transform:none;--padding-bottom:10px;--padding-top:10px;--padding-start:7px;--padding-end:7px}ion-item[_ngcontent-%COMP%]:nth-child(odd){--background:#f6fdff}ion-reorder[_ngcontent-%COMP%]{margin:0}ion-item.overdue[_ngcontent-%COMP%]{--border-color:red;--inner-border-width:0}ion-item.overdue[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .client-id[_ngcontent-%COMP%]{color:red}.turned[_ngcontent-%COMP%]{transform:rotate(.5turn)}.c-body[_ngcontent-%COMP%], .c-wrp[_ngcontent-%COMP%]{height:100%}.call-window[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6)}.call-window[_ngcontent-%COMP%], .call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]{width:85%;flex-direction:column;background:#fff;border-radius:5px;position:relative}.call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;height:44px;width:80%;box-shadow:0 0 .5px .5px #7cd5ff;border-radius:3px;margin:5px 0;text-transform:uppercase}"],data:{animation:[Object(g.j)("openClose",[Object(g.g)("open",Object(g.h)({height:"125px"})),Object(g.g)("closed",Object(g.h)({height:"80px"})),Object(g.i)("open => closed",[Object(g.e)("0.5s")]),Object(g.i)("closed => open",[Object(g.e)("0.5s")])])]}}),t})();Object(s.r)(c.a,"ru");const ct=[{path:"",component:rt}];let at=(()=>{class t{}return t.\u0275mod=a.Gb({type:t}),t.\u0275inj=a.Fb({factory:function(n){return new(n||t)},providers:[{provide:a.u,useFactory:()=>"ru"}],imports:[[u.a,s.c,b.b,o.c,d.D,i.e,l.i.forChild(ct)]]}),t})()}}]);