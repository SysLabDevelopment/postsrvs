!function(){function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function e(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{SdKL:function(n,o,i){"use strict";i.r(o),i.d(o,"CourierPageModule",(function(){return Ct}));var r,c,s=i("ltgo"),a=i("7KAL"),u=i("SVse"),b=i("wq8c"),l=i.n(b),d=i("8Y7J"),h=i("s7LF"),g=i("iInd"),f=i("sZkV"),p=i("sbs8"),v=i("mrSG"),m=i("GS7A"),_=i("zA0m"),C=i("hnS/"),k=i("xoVG"),O=i("/hfl"),M=i("oXA7"),y=i("bk9D"),w=i("rdQv"),P=i("D279"),L=i("dKCF"),I=((r=function(){function n(){t(this,n)}return e(n,[{key:"ngOnInit",value:function(){}}]),n}()).\u0275fac=function(t){return new(t||r)},r.\u0275cmp=d.Cb({type:r,selectors:[["app-help"]],decls:16,vars:0,consts:[[1,"body"],[1,"title"],["lines","none"],["name","ellipsis-vertical","slot","start"],["src","../../../assets/show-actions-helper.svg","slot","start"],["name","search","slot","start"]],template:function(t,n){1&t&&(d.Lb(0,"div",0),d.Lb(1,"h5",1),d.pc(2,"\u041f\u043e\u043c\u043e\u0449\u044c"),d.Kb(),d.Lb(3,"ion-list"),d.Lb(4,"ion-item",2),d.Jb(5,"ion-icon",3),d.Lb(6,"ion-label"),d.pc(7,"\u0414\u043b\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0437\u0430\u0436\u043c\u0438\u0442\u0435 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435"),d.Kb(),d.Kb(),d.Lb(8,"ion-item",2),d.Jb(9,"ion-icon",4),d.Lb(10,"ion-label"),d.pc(11,"\u0427\u0442\u043e\u0431\u044b \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u043f.\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0437\u0430\u043a\u0430\u0437\u0430 \u043a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043d\u0430 \u0437\u0430\u043a\u0430\u0437 \u0434\u0432\u0430\u0436\u0434\u044b \u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u0433\u043e\u043b\u0443\u0431\u0443\u044e \u043a\u043d\u043e\u043f\u043a\u0443"),d.Kb(),d.Kb(),d.Lb(12,"ion-item",2),d.Jb(13,"ion-icon",5),d.Lb(14,"ion-label"),d.pc(15,"\u0427\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u0437\u0430\u043a\u0430\u0437 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443,\u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0438\u043b\u0438 \u0430\u0434\u0440\u0435\u0441\u0443, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0443\u0436\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043f\u043e\u0438\u0441\u043a\u0435 \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0430\u043c"),d.Kb(),d.Kb(),d.Kb(),d.Kb())},directives:[f.r,f.p,f.m,f.q],styles:[".body[_ngcontent-%COMP%]{padding:8px 10px 10px 13px}.body[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#2b637e;font-size:14px;font-weight:700}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start:0}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 5px 0 0;font-size:3em}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:12px;white-space:normal}"]}),r),K=i("1tbR"),x=((c=function(){function n(e,o){t(this,n),this.sysMap=e,this.viewCtrl=o}return e(n,[{key:"ngOnInit",value:function(){this.note=localStorage.getItem(this.orderId)}},{key:"saveNote",value:function(){localStorage.setItem(this.orderId,this.note),this.sysMap.infoUpdated.next(null),this.viewCtrl.dismiss()}}]),n}()).\u0275fac=function(t){return new(t||c)(d.Ib(P.a),d.Ib(f.K))},c.\u0275cmp=d.Cb({type:c,selectors:[["app-note"]],inputs:{orderId:"orderId"},decls:4,vars:1,consts:[["placeholder","\u0412\u0430\u0448\u0430 \u0437\u0430\u043c\u0435\u0442\u043a\u0430 \u043e \u0437\u0430\u043a\u0430\u0437\u0435",3,"ngModel","ngModelChange"],[3,"click"],["name","save"]],template:function(t,n){1&t&&(d.Lb(0,"ion-item"),d.Lb(1,"ion-textarea",0),d.Sb("ngModelChange",(function(t){return n.note=t})),d.Kb(),d.Kb(),d.Lb(2,"ion-button",1),d.Sb("click",(function(){return n.saveNote()})),d.Jb(3,"i-feather",2),d.Kb()),2&t&&(d.yb(1),d.bc("ngModel",n.note))},directives:[f.p,f.B,f.N,h.f,h.g,f.f,K.a],styles:[""],changeDetection:0}),c),S=i("lGQG"),j=i("24R0"),U=i("6nr9"),D=i("ndxW"),$=i("tudd"),R=i("X5X/"),V=["sInput"];function z(t,n){1&t&&(d.Lb(0,"ion-button"),d.Lb(1,"i"),d.pc(2,"G"),d.Kb(),d.Kb())}function E(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-button",2),d.Sb("click",(function(){return d.jc(e),d.Ub().submitOrder()})),d.Jb(1,"i-feather",25),d.Kb()}}function J(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-button",2),d.Sb("click",(function(){return d.jc(e),d.Ub().endWork()})),d.Jb(1,"i-feather",26),d.Kb()}}function W(t,n){if(1&t&&(d.Lb(0,"span"),d.pc(1),d.Vb(2,"date"),d.Kb()),2&t){var e=d.Ub().$implicit;d.yb(1),d.rc("c ",d.Yb(2,1,e.datetime_from,"H:mm","ru")," ")}}function T(t,n){if(1&t&&(d.Lb(0,"span"),d.pc(1),d.Vb(2,"date"),d.Kb()),2&t){var e=d.Ub().$implicit;d.yb(1),d.rc("\u0434\u043e ",d.Yb(2,1,e.datetime_to,"H:mm","ru"),"")}}function A(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",40),d.Lb(1,"ion-button",41),d.Sb("click",(function(t){d.jc(e);var n=d.Ub().$implicit;return d.Ub(2).note(t,n.id),t.stopPropagation()})),d.Jb(2,"ion-icon",42),d.pc(3," \u0417\u0430\u043c\u0435\u0442\u043a\u0438 "),d.Kb(),d.Lb(4,"ion-button",43),d.Sb("click",(function(t){d.jc(e);var n=d.Ub().$implicit;return d.Ub(2).showRoute(n),t.stopPropagation()})),d.Jb(5,"ion-icon",44),d.pc(6," \u041c\u0430\u0440\u0448\u0440\u0443\u0442 "),d.Kb(),d.Lb(7,"ion-button",45),d.Sb("click",(function(t){d.jc(e);var n=d.Ub().$implicit;return d.Ub(2).phoneClick("init",n),t.stopPropagation()})),d.Jb(8,"ion-icon",46),d.pc(9," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c "),d.Kb(),d.Kb()}}var N=function(t){return{overdue:t}},q=function(t){return{turned:t}};function F(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-item",31),d.Sb("click",(function(){d.jc(e);var t=n.$implicit;return d.Ub(2).selectOrder(t.id)}))("longPress",(function(){return d.jc(e),d.Ub(2).vibr()}))("hold",(function(){return d.jc(e),d.Ub(2).vibr()}))("cdkDragStarted",(function(){return d.jc(e),d.Ub(2).vibr()})),d.Lb(1,"ion-label"),d.Lb(2,"div",32),d.Lb(3,"span"),d.Lb(4,"span",33),d.pc(5),d.Kb(),d.Lb(6,"span"),d.pc(7),d.Kb(),d.Kb(),d.Lb(8,"span",33),d.oc(9,W,3,5,"span",4),d.oc(10,T,3,5,"span",4),d.Kb(),d.Kb(),d.Lb(11,"div",34),d.pc(12),d.Kb(),d.Lb(13,"div",35),d.pc(14),d.Kb(),d.oc(15,A,10,0,"div",36),d.Kb(),d.Jb(16,"ion-icon",37),d.Lb(17,"div",38),d.Sb("click",(function(t){d.jc(e);var o=n.$implicit;return o.show=!o.show,t.stopPropagation()})),d.Jb(18,"ion-icon",39),d.Kb(),d.Kb()}if(2&t){var o=n.$implicit,i=d.Ub(2);d.bc("ngClass",d.ec(12,N,("1"==o.overdue||1==o.required)&&1==o.status_id))("cdkDragStartDelay",500)("cdkDragDisabled",i.noDrag),d.yb(1),d.bc("@openClose",o.show?"open":"closed"),d.yb(4),d.rc(" ",o.client_id,""),d.yb(2),d.rc(" (",o.company,")"),d.yb(2),d.bc("ngIf",o.datetime_from),d.yb(1),d.bc("ngIf",o.datetime_to),d.yb(2),d.qc(o.client_fio),d.yb(2),d.qc(o.client_address),d.yb(1),d.bc("ngIf",o.show),d.yb(3),d.bc("ngClass",d.ec(14,q,1==o.show))}}function B(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",27),d.Lb(1,"ion-searchbar",28),d.Sb("ionChange",(function(t){return d.jc(e),d.Ub().onSearchChange(t)}))("ngModelChange",(function(t){return d.jc(e),d.Ub().searchString=t})),d.Kb(),d.Lb(2,"cdk-virtual-scroll-viewport",29),d.Sb("cdkDropListDropped",(function(t){return d.jc(e),d.Ub().drop(t)})),d.oc(3,F,19,16,"ion-item",30),d.Vb(4,"async"),d.Kb(),d.Kb()}if(2&t){var o=d.Ub();d.yb(1),d.bc("debounce",250)("ngModel",o.searchString),d.yb(2),d.bc("ngForOf",d.Wb(4,3,o.orders_c))}}function G(t,n){if(1&t&&(d.Lb(0,"div",47),d.Lb(1,"span"),d.pc(2,"\u0412 \u0440\u0430\u0431\u043e\u0442\u0435:"),d.Kb(),d.pc(3),d.Kb()),2&t){var e=d.Ub();d.yb(3),d.rc(" ",null==e.courier.sortOrders?null:e.courier.sortOrders.g_process," ")}}function H(t,n){if(1&t&&(d.Lb(0,"div",47),d.Lb(1,"span"),d.pc(2,"\u041d\u0435 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e:"),d.Kb(),d.Lb(3,"span",48),d.pc(4),d.Kb(),d.Kb()),2&t){var e=d.Ub();d.yb(4),d.qc(e.courier.sortOrders.g_fail)}}function Q(t,n){if(1&t&&(d.Lb(0,"div",47),d.Lb(1,"span"),d.pc(2,"\u0414\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e:"),d.Kb(),d.pc(3),d.Kb()),2&t){var e=d.Ub();d.yb(3),d.rc(" ",e.courier.sortOrders.g_done," ")}}function X(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-button",51),d.Sb("click",(function(){return d.jc(e),d.Ub(2).auth.check("In")})),d.pc(1," \u041f\u0440\u0438\u0435\u0445\u0430\u043b \u043d\u0430 \u0441\u043a\u043b\u0430\u0434 "),d.Kb()}}function Y(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-button",51),d.Sb("click",(function(){return d.jc(e),d.Ub(2).auth.check("Out")})),d.pc(1," \u0423\u0435\u0445\u0430\u043b \u0441\u043e \u0441\u043a\u043b\u0430\u0434\u0430 "),d.Kb()}}function Z(t,n){if(1&t&&(d.Lb(0,"div",49),d.oc(1,X,2,0,"ion-button",50),d.oc(2,Y,2,0,"ion-button",50),d.Kb()),2&t){var e=d.Ub();d.yb(1),d.bc("ngIf","checkedundefined"==e.auth.checkState),d.yb(1),d.bc("ngIf","checkedIn"==e.auth.checkState)}}function tt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",56),d.Sb("click",(function(){return d.jc(e),d.Ub(2).startRoute()})),d.pc(1," \u041d\u0430\u0447\u0430\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442 "),d.Kb()}}function nt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",57),d.Sb("click",(function(){return d.jc(e),d.Ub(2).stopRoute()})),d.pc(1," \u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442 "),d.Kb()}}function et(t,n){1&t&&(d.Lb(0,"span"),d.pc(1,"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"),d.Kb())}function ot(t,n){1&t&&(d.Lb(0,"span"),d.pc(1,"\u0420\u0443\u0447\u043d\u043e\u0439 \u0440\u0435\u0436\u0438\u043c"),d.Kb())}var it=function(t){return{manual_btn:t}};function rt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",58),d.Sb("click",(function(){return d.jc(e),d.Ub(2).manualRoute()})),d.oc(1,et,2,0,"span",4),d.oc(2,ot,2,0,"span",4),d.Kb()}if(2&t){var o=d.Ub(2);d.bc("ngClass",d.ec(3,it,o.state$.manual_route)),d.yb(1),d.bc("ngIf",o.state$.manual_route),d.yb(1),d.bc("ngIf",!o.state$.manual_route)}}function ct(t,n){if(1&t&&(d.Lb(0,"div",52),d.oc(1,tt,2,0,"button",53),d.oc(2,nt,2,0,"button",54),d.oc(3,rt,3,5,"button",55),d.Kb()),2&t){var e=d.Ub();d.yb(1),d.bc("ngIf",!e.btn_go&&!e.state$.manual_route&&e.auth.routingModeAuto),d.yb(1),d.bc("ngIf",e.btn_go&&!e.state$.manual_route),d.yb(1),d.bc("ngIf","auto"==e.auth.getMode()||"auto_wo"==e.auth.getMode())}}function st(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",59),d.Lb(1,"div",60),d.Lb(2,"div",61),d.pc(3,"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 \u0448\u0442\u0440\u0438\u0445\u043a\u043e\u0434"),d.Kb(),d.Lb(4,"input",62,63),d.Sb("change",(function(){return d.jc(e),d.Ub().scanInputChange()}))("ngModelChange",(function(t){return d.jc(e),d.Ub().scanInput=t})),d.Kb(),d.Kb(),d.Kb()}if(2&t){var o=d.Ub();d.yb(4),d.bc("ngModel",o.scanInput)}}function at(t,n){1&t&&(d.Lb(0,"div",64),d.Jb(1,"ion-spinner",65),d.Kb())}function ut(t,n){if(1&t&&(d.Lb(0,"ion-item"),d.Jb(1,"ion-radio",71),d.Lb(2,"ion-label"),d.pc(3),d.Kb(),d.Kb()),2&t){var e=n.$implicit;d.yb(1),d.cc("value",e),d.yb(2),d.qc(e)}}function bt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-list"),d.Lb(1,"ion-radio-group",69),d.Sb("ngModelChange",(function(t){return d.jc(e),d.Ub(2).selectedPhone=t})),d.Lb(2,"ion-list-header"),d.Lb(3,"ion-label"),d.pc(4,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440"),d.Kb(),d.Kb(),d.oc(5,ut,4,2,"ion-item",70),d.Kb(),d.Kb()}if(2&t){var o=d.Ub(2);d.yb(1),d.bc("ngModel",o.selectedPhone),d.yb(4),d.bc("ngForOf",o.orderPhones)}}function lt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",2),d.Sb("click",(function(){d.jc(e);var t=d.Ub(2);return t.phoneClick("phone",t.order)})),d.pc(1," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0441\u043e \u0441\u0432\u043e\u0435\u0433\u043e \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 "),d.Kb()}}function dt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",2),d.Sb("click",(function(){d.jc(e);var t=d.Ub(2);return t.phoneClick("operator",t.order)})),d.pc(1," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 ip-\u0448\u043b\u044e\u0437 "),d.Kb()}}function ht(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",66),d.Lb(1,"div",67),d.Lb(2,"i-feather",68),d.Sb("click",(function(){d.jc(e);var t=d.Ub();return t.callWindow=!t.callWindow})),d.Kb(),d.oc(3,bt,6,2,"ion-list",4),d.oc(4,lt,2,0,"button",8),d.oc(5,dt,2,0,"button",8),d.Kb(),d.Kb()}if(2&t){var o=d.Ub();d.yb(3),d.bc("ngIf",o.orderPhones.length>1),d.yb(1),d.bc("ngIf","robotPhone"==o.settings.rules.phoneMode||"phone"==o.settings.rules.phoneMode),d.yb(1),d.bc("ngIf","robotPhone"==o.settings.rules.phoneMode||"robot"==o.settings.rules.phoneMode)}}var gt,ft=function(t){return{m_wrp:t}},pt=function(){return[]},vt=((gt=function(){function n(e,o,i,r,c,s,a,u,b,l,d,h,g,f){t(this,n),this.courier=e,this.router=o,this.state$=i,this.auth=r,this.bs=c,this.vbr=s,this.settings=a,this.sys=u,this.data=b,this.popoverController=l,this.map=d,this.orderService=h,this.CL=g,this.network=f,this.orders=null,this.statuses=null,this.selectedTab=1,this.ordersInit=!1,this.loader=!1,this.local_stop$=new M.a,this.localcheck=!1,this.g_done=0,this.g_process=0,this.g_fail=0,this.lvl_ind={width:"0%"},this.btn_go=!1,this.subBtnCond=!0,this.scanView=!1,this.scan_process=!1,this.find_order=!1,this.isWorkEnded=!1,this.searchString="",this.slicer=this.howSlice(),this.callWindow=!1,this.noDrag=!1,this.segment=[1];var p=this;this.initContent(),null!=this.state$.position.getValue()&&this.startRoute(!1),this.state$.state.pipe(Object(y.a)(this.local_stop$)).subscribe((function(t){"orders_init"==t&&p.initContent()})),this.initConditions(),this.ord=this.data.orders.asObservable(),this.prepareOrdersList()}return e(n,[{key:"initConditions",value:function(){switch(this.auth.getMode()){case"fullAuto":this.state$.confirmed||(this.subBtnCond=!0);break;case"auto":this.subBtnCond=!1;break;case"fullHand":this.state$.confirmed||(this.subBtnCond=!0);break;case"hand":this.subBtnCond=!1}}},{key:"ngAfterViewChecked",value:function(){var t=this;this.Drop_L.autoScrollDisabled=!1,this.DragItems.changes.subscribe((function(n){t.DragItems.forEach((function(t){t.dragStartDelay={touch:500,mouse:100}}))}))}},{key:"ngOnInit",value:function(){var t=this;this.settings.checkout=!!(this.settings.rules.storeCheckMode-0),this.auth.checkState=this.settings.checkout?"checked"+localStorage.check:"checkedOut","hand"==this.settings.rules.appMode&&(this.state$.manual_route=!0),this.settings.rules.appMode.toLowerCase().includes("auto")&&(this.noDrag=!0),this.data.orders.subscribe((function(n){t.courier.count_orders(n)}))}},{key:"scanInputStart",value:function(){var t=this;this.scanView=!this.scanView,this.loader=!0,"scan"==this.auth.getScanMode()?t.courier.findOrder(this.scanInput).subscribe((function(n){t.scanInput=null,"true"==n.success?t.courier.sumbitOrder(n.order_id).subscribe((function(n){console.log("courier_page sbo resp",n),n?t.submitOrder():t.scanView=!1,t.loader=!1})):(t.auth.showError(2),t.loader=!1,t.scanView=!1),t.state$.confirmed=!0,t.orders.forEach((function(n){"0"==n.confirm&&(t.state$.confirmed=!1)}))})):t.loader=!1,this.scan_process=!1}},{key:"scanInputChange",value:function(){console.log("inputData",this.scanInput);var t=this;if(this.scan_process)return!1;this.scan_process=!0,this.find_order?setTimeout((function(){t.scanSearch()}),1500):setTimeout((function(){t.scanInputStart()}),1500)}},{key:"submitOrder",value:function(){var t=this;if(console.log("SUBMIT_ORDER_CALL"),"scan"==this.auth.getScanMode())return this.scanView=!this.scanView,setTimeout((function(){t.sInput.nativeElement.focus()}),500),!1;this.bs.scan().then((function(n){console.log("SCAN_RETURN_DATA",n),""!=n.text?(t.loader=!0,t.courier.findOrder(n.text).subscribe((function(n){"true"==n.success?t.courier.sumbitOrder(n.order_id).subscribe((function(n){n&&t.submitOrder(),t.loader=!1})):(t.auth.showError(2),t.loader=!1),t.state$.confirmed=!0,t.orders.forEach((function(n){"0"==n.confirm&&(t.state$.confirmed=!1)}))}))):t.loader=!1}))}},{key:"ordersListChanged",value:function(t){this.orders=t;var n=new Array;t.forEach((function(t){1==Number(t.status_id)&&n.push(t.id)})),this.state$.old_way=n}},{key:"ngOnDestroy",value:function(){this.local_stop$.next(null),this.state$.orders_page_check=!1}},{key:"manualRoute",value:function(){this.courier.changeRouteMode(this.state$.manual_route?"auto":"fullHand"),this.vbr.vibrate(300)}},{key:"initContent",value:function(){var t=this,n=this;this.state$.orders.subscribe((function(){t.orders=t.state$.orders_data,console.log("sys::init\u0421ontent orders",t.orders),t.statuses=[{id:4,status:"\u041d\u0435 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"},{id:5,status:"\u0414\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"},{id:6,status:"\u0427\u0430\u0441\u0442\u0438\u0447\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"}],t.ordersInit=!0,n.count_orders()}))}},{key:"getStatus",value:function(t){return this.courier.getStatus(t)}},{key:"selectOrder",value:function(t){this.router.navigate(["/order",t])}},{key:"tabSelect",value:function(t){this.selectedTab=t}},{key:"customTrackBy",value:function(t,n){return t}},{key:"getCondition",value:function(t){switch(this.selectedTab){case 1:if(1==t)return!0;break;case 2:if(5==t||6==t)return!0;break;case 3:if(4==t)return!0}return!1}},{key:"count_orders",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.courier.ordersInfo,n=0,e=0,o=0,i=0;i<t.length;i++)switch(String(t[i].status_id)){case"4":o++;break;case"5":case"6":n++;break;case"1":e++}this.g_done=n,this.g_process=e,this.g_fail=o}},{key:"startRoute",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=this;this.auth.checkAuth().subscribe((function(o){"true"==o.success&&e.sendStartRoute(o.sync_id,t,n)}))}},{key:"stopRoute",value:function(){this.startRoute(!1,!0)}},{key:"sendStartRoute",value:function(t,n,e){var o={cid:t,lt:this.state$.position.getValue().lt,lg:this.state$.position.getValue().lg,start:"",stop:""};n&&(o.start="1"),e&&(o.stop="1");var i=this;this.auth.sendPost("geo/route_start.php",o).subscribe((function(t){1==t.success&&(i.btn_go=!0,"stop"==t.result&&(i.btn_go=!1))}))}},{key:"scanSearch",value:function(){var t=this;this.scanView=!this.scanView,this.loader=!0,"scan"==this.auth.getScanMode()?t.courier.findOrder(this.scanInput).subscribe((function(n){t.scanInput=null,"true"==n.success?t.selectOrder(n.order_id):t.auth.showError(2),t.loader=!1,t.scanView=!1})):t.loader=!1,this.scan_process=!1,this.find_order=!1}},{key:"findOrder",value:function(){var t=this;if("scan"==this.auth.getScanMode())return this.scanView=!this.scanView,this.find_order=!0,setTimeout((function(){t.sInput.nativeElement.focus()}),500),!1;this.bs.scan().then((function(n){t.courier.findOrder(n.text).subscribe((function(n){"true"==n.success?t.selectOrder(n.order_id):t.auth.showError(2)}))}))}},{key:"endWork",value:function(){var t=this;this.courier.endWork().subscribe((function(n){n.success&&(t.isWorkEnded=!0,t.sys.presentToast("\u0420\u0430\u0431\u043e\u0447\u0438\u0439 \u0434\u0435\u043d\u044c \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d","success"))}),(function(n){t.sys.presentToast("\u041e\u0448\u0438\u0431\u043a\u0430: "+n.message,"danger")}))}},{key:"doRefresh",value:function(){this.data.getApiData()}},{key:"segmentChanged",value:function(t){var n=[Number(t.target.value)];"5"==t.target.value&&n.push(6),this.segment=n,this.prepareOrdersList(n)}},{key:"onSearchChange",value:function(t){this.searchString=t.target.value,this.prepareOrdersList(this.segment)}},{key:"prepareOrdersList",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.segment;this.orders_c=this.ord.pipe(Object(w.a)((function(e){return e&&e.filter((function(t){return n.includes(Number(t.status_id))})).filter((function(n){return n.client_address.toLowerCase().includes(t.searchString.toLowerCase())||n.client_fio.toLowerCase().includes(t.searchString.toLowerCase())||n.client_id.toLowerCase().includes(t.searchString.toLowerCase())})).slice(t.slicer)})),Object(w.a)((function(n){return n.forEach((function(t){t.show=!1})),t.orders=n,n})))}},{key:"howSlice",value:function(){return"standart"===this.settings.rules.typeRoute?0:1}},{key:"popoverHelp",value:function(t){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.popoverController.create({component:I,event:t,translucent:!0,cssClass:"help"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"showHelp",value:function(t){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.popoverHelp(t);case 2:n.sent.present();case 3:case"end":return n.stop()}}),n,this)})))}},{key:"showRoute",value:function(t){this.map.showRoute(t)}},{key:"drop",value:function(t){Object(s.d)(this.orders,t.previousIndex,t.currentIndex),this.data.rewriteOrders(this.orders),console.log("sys:: \u043c\u0430\u0441\u0441\u0438\u0432 \u0437\u0430\u043a\u0430\u0437\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u044f: ",this.orders)}},{key:"popoverNote",value:function(t,n){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popoverController.create({component:x,event:t,translucent:!0,cssClass:"help",componentProps:{orderId:n}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"note",value:function(t,n){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popoverNote(t,n);case 2:e.sent.present();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"phoneClick",value:function(t,n){this.order=n,this.orderPhones=this.parsePhone(n.client_phone);var e=this.parsePhone(n.courier_phone)[0];switch(1==this.orderPhones.length&&(this.selectedPhone=this.orderPhones[0]),t){case"init":this.callWindow=!this.callWindow;break;case"phone":this.CL.callNumber(this.selectedPhone,!1).then((function(){})),this.callWindow=!1,this.order=void 0;break;case"operator":if("none"==this.network.type)return this.phoneClick("phone",n),!1;this.selectedPhone&&e&&(this.auth.sendPost("orders",{action:"send_phone",client_number:this.selectedPhone,cur_number:e}).subscribe((function(t){console.log("call_subs",t)})),this.auth.showError(9),this.callWindow=!1),this.order=void 0}}},{key:"parsePhone",value:function(t){var n=[];for(t=t.replace(/\D+/g,"");t.length>7;)t=this.normalizePhoneNumber(t),n.push(t.slice(null,11)),t=t.slice(11);return n}},{key:"normalizePhoneNumber",value:function(t){return"8"!==t[0]&&"7"!==t[0]&&11!==t.length&&(t="8"+t),7!=t.length&&10!=t.length||(t="8"+t),"8"!==t[0]&&11==t.length&&(t="8"+t.slice(1)),t}},{key:"vibr",value:function(t){this.vbr.vibrate(10),console.log("sys:: *\u0412\u0438\u0431\u0438\u0440\u0430\u0446\u0438\u044f*")}}]),n}()).\u0275fac=function(t){return new(t||gt)(d.Ib(j.a),d.Ib(g.g),d.Ib(D.a),d.Ib(S.a),d.Ib(_.a),d.Ib(O.a),d.Ib(U.a),d.Ib($.a),d.Ib(R.a),d.Ib(f.K),d.Ib(P.a),d.Ib(L.a),d.Ib(C.a),d.Ib(k.a))},gt.\u0275cmp=d.Cb({type:gt,selectors:[["app-courier"]],viewQuery:function(t,n){var e;1&t&&(d.tc(V,!0),d.tc(s.b,!0),d.tc(s.a,!0)),2&t&&(d.hc(e=d.Tb())&&(n.sInput=e.first),d.hc(e=d.Tb())&&(n.Drop_L=e.first),d.hc(e=d.Tb())&&(n.DragItems=e))},decls:44,vars:18,consts:[[1,"toolbar"],["slot","start"],[3,"click"],["name","search","slot","start"],[4,"ngIf"],["size","small","color","dark"],["slot","primary"],["slot","icon-only","name","refresh-circle-sharp"],[3,"click",4,"ngIf"],["slot","icon-only","name","help-circle-outline"],[1,"c-wrp",3,"ngClass"],["value","1",3,"ionChange"],["value","1"],["value","5"],["value","4"],["class","c-body",4,"ngIf"],[1,"ion-padding","sub-footer"],[1,"orders-lable","ion-justify-content-between","ion-wrap"],[1,"ion-margin-vertical"],["class","ion-margin",4,"ngIf"],["class","checking",4,"ngIf"],["class","start-route",4,"ngIf"],["class","scanWindow",4,"ngIf"],["class","shirm",4,"ngIf"],["class","call-window",4,"ngIf"],["name","box"],["name","check-square"],[1,"c-body"],["placeholder","\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0430\u043c","inputmode","text","animated","",3,"debounce","ngModel","ionChange","ngModelChange"],["cdkDropList","","itemSize","50",2,"height","100%","width","100%","min-height","50vh",3,"cdkDropListDropped"],["appLongPress","","cdkDrag","",3,"ngClass","cdkDragStartDelay","cdkDragDisabled","click","longPress","hold","cdkDragStarted",4,"ngFor","ngForOf"],["appLongPress","","cdkDrag","",3,"ngClass","cdkDragStartDelay","cdkDragDisabled","click","longPress","hold","cdkDragStarted"],[1,"title"],[1,"client-id"],[1,"name"],[1,"addr"],["class","actions",4,"ngIf"],["name","ellipsis-vertical","slot","start",1,"points"],[1,"actions-button",3,"click"],["src","../../../assets/actions-arrows.svg",3,"ngClass"],[1,"actions"],["fill","solid","size","default","id","light-blue-button",3,"click"],["slot","start","name","document"],["fill","solid","size","default","id","light-purple-button",3,"click"],["slot","start","name","location-outline"],["fill","solid","size","default","id","light-green-button",3,"click"],["slot","start","name","call-outline"],[1,"ion-margin"],[2,"color","red"],[1,"checking"],["expand","full","fill","solid",3,"click",4,"ngIf"],["expand","full","fill","solid",3,"click"],[1,"start-route"],["class","satrt-r-btn",3,"click",4,"ngIf"],["class","satrt-r-btn sr-stop",3,"click",4,"ngIf"],["class","satrt-r-btn find-o-btn",3,"ngClass","click",4,"ngIf"],[1,"satrt-r-btn",3,"click"],[1,"satrt-r-btn","sr-stop",3,"click"],[1,"satrt-r-btn","find-o-btn",3,"ngClass","click"],[1,"scanWindow"],[1,"sw-wrp"],[1,"sw-title"],["autofocus","",1,"ionInp",3,"ngModel","change","ngModelChange"],["sInput",""],[1,"shirm"],["name","lines-small"],[1,"call-window"],[1,"cw-body"],["name","x-square","size","large",3,"click"],["name","selectedPhone",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){1&t&&(d.Lb(0,"ion-header"),d.Lb(1,"ion-toolbar",0),d.Lb(2,"ion-buttons",1),d.Lb(3,"ion-button",2),d.Sb("click",(function(){return n.findOrder()})),d.Jb(4,"i-feather",3),d.Kb(),d.oc(5,z,3,0,"ion-button",4),d.Kb(),d.Lb(6,"ion-title"),d.pc(7,"\u041c\u043e\u0438 \u0437\u0430\u043a\u0430\u0437\u044b"),d.Kb(),d.Lb(8,"ion-title",5),d.pc(9),d.Kb(),d.Lb(10,"ion-buttons",6),d.Lb(11,"ion-button",2),d.Sb("click",(function(){return n.doRefresh()})),d.Jb(12,"ion-icon",7),d.Kb(),d.oc(13,E,2,0,"ion-button",8),d.oc(14,J,2,0,"ion-button",8),d.Lb(15,"ion-button",2),d.Sb("click",(function(t){return n.showHelp(t)})),d.Jb(16,"ion-icon",9),d.Kb(),d.Kb(),d.Kb(),d.Kb(),d.Lb(17,"ion-content"),d.Lb(18,"div",10),d.Lb(19,"ion-segment",11),d.Sb("ionChange",(function(t){return n.segmentChanged(t)})),d.Lb(20,"ion-segment-button",12),d.Lb(21,"ion-label"),d.pc(22,"\u0412 \u0440\u0430\u0431\u043e\u0442\u0435"),d.Kb(),d.Kb(),d.Lb(23,"ion-segment-button",13),d.Lb(24,"ion-label"),d.pc(25,"\u0414\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"),d.Kb(),d.Kb(),d.Lb(26,"ion-segment-button",14),d.Lb(27,"ion-label"),d.pc(28,"\u041d\u0435 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"),d.Kb(),d.Kb(),d.Kb(),d.oc(29,B,5,5,"div",15),d.Lb(30,"div",16),d.Lb(31,"div",17),d.Lb(32,"div",18),d.Lb(33,"span"),d.pc(34,"\u0412\u0441\u0435\u0433\u043e:"),d.Kb(),d.pc(35),d.Kb(),d.oc(36,G,4,1,"div",19),d.oc(37,H,5,1,"div",19),d.oc(38,Q,4,1,"div",19),d.Kb(),d.oc(39,Z,3,2,"div",20),d.Kb(),d.oc(40,ct,4,3,"div",21),d.oc(41,st,6,1,"div",22),d.Kb(),d.oc(42,at,2,0,"div",23),d.oc(43,ht,6,3,"div",24),d.Kb()),2&t&&(d.yb(5),d.bc("ngIf",n.auth.getGuessMode()),d.yb(4),d.qc(n.state$.filial),d.yb(4),d.bc("ngIf",n.subBtnCond),d.yb(1),d.bc("ngIf",0==(null==n.courier.sortOrders?null:n.courier.sortOrders.g_process)&&!n.isWorkEnded),d.yb(4),d.bc("ngClass",d.ec(15,ft,"fullHand"==n.auth.getMode()||"hand"==n.auth.getMode())),d.yb(11),d.bc("ngIf",n.ordersInit&&!n.auth.getGuessMode()),d.yb(6),d.rc(" ",n.courier.sortOrders.all," "),d.yb(1),d.bc("ngIf",0!=n.courier.sortOrders.g_process),d.yb(1),d.bc("ngIf",0!=n.courier.sortOrders.g_fail),d.yb(1),d.bc("ngIf",0!=n.courier.sortOrders.g_done),d.yb(1),d.bc("ngIf","checkedOut"!==n.auth.checkState),d.yb(1),d.bc("ngIf",n.ordersInit&&n.state$.orders_data!=d.dc(17,pt)&&null!==n.state$.orders_data&&"checkedOut"==n.auth.checkState),d.yb(1),d.bc("ngIf",n.scanView),d.yb(1),d.bc("ngIf",n.loader),d.yb(1),d.bc("ngIf",n.callWindow))},directives:[f.l,f.E,f.g,f.f,K.a,u.l,f.C,f.m,f.j,u.j,f.x,f.M,f.y,f.q,f.w,f.N,h.f,h.g,a.c,a.a,s.b,u.k,f.p,s.a,h.a,f.z,f.r,f.u,f.s,f.t,f.L],pipes:[u.b,u.e],styles:["ion-chip[_ngcontent-%COMP%]{white-space:nowrap}.headbar-right-buttons[_ngcontent-%COMP%]{position:fixed;right:0;z-index:999999;top:0;display:flex}ion-toolbar[_ngcontent-%COMP%]{--min-height:30px}.toolbar[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{font-size:16px}ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:30px}ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.fether[_ngcontent-%COMP%]{height:16px}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background:#e5f0f4;--border-style:solid;--border-width:0.5px;--color:#585454;--color-checked:#2b637e;--indicator-height:0}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{text-transform:none}ion-segment[_ngcontent-%COMP%]   ion-segment-button.segment-button-checked[_ngcontent-%COMP%]{border-bottom:#fff}ion-searchbar[_ngcontent-%COMP%]{--box-shadow:0 0 01px #000;padding-left:2px;padding-right:2px}ion-item[_ngcontent-%COMP%]{--border-color:#d6cfcf;--border-width:1px;--border-radius:2px;--padding-start:0;margin:0 2px 5px;--inner-border-width:0}ion-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;font-size:14px}ion-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .client-id[_ngcontent-%COMP%]{color:#2b637e}ion-item[_ngcontent-%COMP%]   .addr[_ngcontent-%COMP%]{color:#585454;font-size:13px;white-space:pre-wrap;padding:5px 0}ion-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{color:#333;font-size:13px;font-weight:700}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{bottom:0}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background:#2b637e;--border-radius:2px;font-size:12px;text-transform:none;--padding-bottom:7px;--padding-top:7px;--padding-start:7px;--padding-end:7px;font-family:Roboto;--box-shadow:none;margin-right:13px;margin-left:0}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:0}ion-item[_ngcontent-%COMP%]   .points[_ngcontent-%COMP%]{margin-right:10px}ion-item[_ngcontent-%COMP%]:nth-child(odd){--background:#f6fdff}ion-reorder[_ngcontent-%COMP%]{margin:0}ion-item.overdue[_ngcontent-%COMP%]{--border-color:red;--inner-border-width:0}ion-item.overdue[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .client-id[_ngcontent-%COMP%]{color:red}.c-body[_ngcontent-%COMP%], .c-wrp[_ngcontent-%COMP%]{height:100%}.call-window[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6)}.call-window[_ngcontent-%COMP%], .call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]{width:85%;flex-direction:column;background:#fff;border-radius:5px;position:relative}.call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;height:44px;width:80%;box-shadow:0 0 .5px .5px #7cd5ff;border-radius:3px;margin:5px 0;text-transform:uppercase}.c-wrp[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:calc(100% - 40px)}.c-wrp[_ngcontent-%COMP%]   .c-body[_ngcontent-%COMP%]{overflow:scroll}.c-wrp[_ngcontent-%COMP%]   .sub-footer[_ngcontent-%COMP%]{box-shadow:0 -2px 3px hsla(0,0%,45.9%,.1)}.c-wrp[_ngcontent-%COMP%]   .sub-footer[_ngcontent-%COMP%]   .orders-lable[_ngcontent-%COMP%]{font-weight:bolder;display:flex}.c-wrp[_ngcontent-%COMP%]   .sub-footer[_ngcontent-%COMP%]   .orders-lable[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{white-space:nowrap;flex:1 1 30%}.c-wrp[_ngcontent-%COMP%]   .sub-footer[_ngcontent-%COMP%]   .orders-lable[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#585454}.c-wrp[_ngcontent-%COMP%]   .sub-footer[_ngcontent-%COMP%]   .checking[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background:var(--corporate);border-radius:2px}.ios[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]{min-height:85vh}.ios[_ngcontent-%COMP%]   ion-content[_ngcontent-%COMP%]   ion-segment[_ngcontent-%COMP%]{height:60px}"],data:{animation:[Object(m.j)("openClose",[Object(m.g)("open",Object(m.h)({height:"auto"})),Object(m.g)("closed",Object(m.h)({height:"max-content"})),Object(m.i)("open => closed",[Object(m.e)("0.5s")]),Object(m.i)("closed => open",[Object(m.e)("0.5s")])])]}}),gt);Object(u.s)(l.a,"ru");var mt,_t=[{path:"",component:vt}],Ct=((mt=function n(){t(this,n)}).\u0275mod=d.Gb({type:mt}),mt.\u0275inj=d.Fb({factory:function(t){return new(t||mt)},providers:[{provide:d.u,useFactory:function(){return"ru"}}],imports:[[p.a,u.c,h.b,s.c,f.F,a.e,g.i.forChild(_t)]]}),mt)}}])}();