!function(){function t(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function n(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function e(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{SdKL:function(n,o,i){"use strict";i.r(o),i.d(o,"CourierPageModule",(function(){return gt}));var r,c,s=i("ltgo"),a=i("7KAL"),u=i("SVse"),b=i("wq8c"),l=i.n(b),d=i("8Y7J"),h=i("s7LF"),g=i("iInd"),f=i("sZkV"),p=i("sbs8"),v=i("mrSG"),m=i("GS7A"),_=i("zA0m"),C=i("hnS/"),k=i("xoVG"),O=i("/hfl"),M=i("XNiG"),w=i("1G5W"),y=i("lJxs"),P=i("D279"),L=i("dKCF"),x=((r=function(){function n(){t(this,n)}return e(n,[{key:"ngOnInit",value:function(){}}]),n}()).\u0275fac=function(t){return new(t||r)},r.\u0275cmp=d.Cb({type:r,selectors:[["app-help"]],decls:16,vars:0,consts:[[1,"body"],[1,"title"],["lines","none"],["name","ellipsis-vertical","slot","start"],["src","../../../assets/show-actions-helper.svg","slot","start"],["name","search","slot","start"]],template:function(t,n){1&t&&(d.Lb(0,"div",0),d.Lb(1,"h5",1),d.rc(2,"\u041f\u043e\u043c\u043e\u0449\u044c"),d.Kb(),d.Lb(3,"ion-list"),d.Lb(4,"ion-item",2),d.Jb(5,"ion-icon",3),d.Lb(6,"ion-label"),d.rc(7,"\u0414\u043b\u044f \u0441\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u0437\u0430\u0436\u043c\u0438\u0442\u0435 \u0437\u0430\u043a\u0430\u0437 \u0438 \u043f\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435"),d.Kb(),d.Kb(),d.Lb(8,"ion-item",2),d.Jb(9,"ion-icon",4),d.Lb(10,"ion-label"),d.rc(11,"\u0427\u0442\u043e\u0431\u044b \u043e\u0442\u043a\u0440\u044b\u0442\u044c \u0434\u043e\u043f.\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0437\u0430\u043a\u0430\u0437\u0430 \u043a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043d\u0430 \u0437\u0430\u043a\u0430\u0437 \u0434\u0432\u0430\u0436\u0434\u044b \u0438\u043b\u0438 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u0433\u043e\u043b\u0443\u0431\u0443\u044e \u043a\u043d\u043e\u043f\u043a\u0443"),d.Kb(),d.Kb(),d.Lb(12,"ion-item",2),d.Jb(13,"ion-icon",5),d.Lb(14,"ion-label"),d.rc(15,"\u0427\u0442\u043e\u0431\u044b \u043d\u0430\u0439\u0442\u0438 \u0437\u0430\u043a\u0430\u0437 \u043f\u043e \u043d\u043e\u043c\u0435\u0440\u0443,\u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0438\u043b\u0438 \u0430\u0434\u0440\u0435\u0441\u0443, \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043d\u0443\u0436\u043d\u044b\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0432 \u043f\u043e\u0438\u0441\u043a\u0435 \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0430\u043c"),d.Kb(),d.Kb(),d.Kb(),d.Kb())},directives:[f.o,f.m,f.k,f.n],styles:[".body[_ngcontent-%COMP%]{padding:8px 10px 10px 13px}.body[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#2b637e;font-size:14px;font-weight:700}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start:0}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 5px 0 0;font-size:3em}.body[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:12px;white-space:normal}"]}),r),I=i("1tbR"),K=((c=function(){function n(e,o){t(this,n),this.sysMap=e,this.viewCtrl=o}return e(n,[{key:"ngOnInit",value:function(){this.note=localStorage.getItem(this.orderId)}},{key:"saveNote",value:function(){localStorage.setItem(this.orderId,this.note),this.sysMap.infoUpdated.next(),this.viewCtrl.dismiss()}}]),n}()).\u0275fac=function(t){return new(t||c)(d.Ib(P.a),d.Ib(f.H))},c.\u0275cmp=d.Cb({type:c,selectors:[["app-note"]],inputs:{orderId:"orderId"},decls:4,vars:1,consts:[["placeholder","\u0412\u0430\u0448\u0430 \u0437\u0430\u043c\u0435\u0442\u043a\u0430 \u043e \u0437\u0430\u043a\u0430\u0437\u0435",3,"ngModel","ngModelChange"],[3,"click"],["name","save"]],template:function(t,n){1&t&&(d.Lb(0,"ion-item"),d.Lb(1,"ion-textarea",0),d.Tb("ngModelChange",(function(t){return n.note=t})),d.Kb(),d.Kb(),d.Lb(2,"ion-button",1),d.Tb("click",(function(){return n.saveNote()})),d.Jb(3,"i-feather",2),d.Kb()),2&t&&(d.yb(1),d.cc("ngModel",n.note))},directives:[f.m,f.A,f.K,h.f,h.g,f.e,I.a],styles:[""],changeDetection:0}),c),V=i("lGQG"),S=i("24R0"),D=i("6nr9"),T=i("ndxW"),$=i("tudd"),R=i("X5X/"),j=["sInput"];function q(t,n){1&t&&(d.Lb(0,"ion-button"),d.Lb(1,"i"),d.rc(2,"G"),d.Kb(),d.Kb())}function J(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-button",2),d.Tb("click",(function(){return d.lc(e),d.Vb().submitOrder()})),d.Jb(1,"i-feather",22),d.Kb()}}function W(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-button",2),d.Tb("click",(function(){return d.lc(e),d.Vb().endWork()})),d.Jb(1,"i-feather",23),d.Kb()}}function z(t,n){if(1&t&&(d.Lb(0,"span"),d.rc(1),d.Wb(2,"date"),d.Kb()),2&t){var e=d.Vb().$implicit;d.yb(1),d.tc("c ",d.Zb(2,1,e.datetime_from,"H:mm","ru")," ")}}function E(t,n){if(1&t&&(d.Lb(0,"span"),d.rc(1),d.Wb(2,"date"),d.Kb()),2&t){var e=d.Vb().$implicit;d.yb(1),d.tc("\u0434\u043e ",d.Zb(2,1,e.datetime_to,"H:mm","ru"),"")}}function A(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",37),d.Lb(1,"ion-button",38),d.Tb("click",(function(t){d.lc(e);var n=d.Vb().$implicit;return d.Vb(2).note(t,n.id),t.stopPropagation()})),d.Jb(2,"ion-icon",39),d.rc(3," \u0417\u0430\u043c\u0435\u0442\u043a\u0438 "),d.Kb(),d.Lb(4,"ion-button",40),d.Tb("click",(function(t){d.lc(e);var n=d.Vb().$implicit;return d.Vb(2).showRoute(n),t.stopPropagation()})),d.Jb(5,"ion-icon",41),d.rc(6," \u041c\u0430\u0440\u0448\u0440\u0443\u0442 "),d.Kb(),d.Lb(7,"ion-button",42),d.Tb("click",(function(t){d.lc(e);var n=d.Vb().$implicit;return d.Vb(2).phoneClick("init",n),t.stopPropagation()})),d.Jb(8,"ion-icon",43),d.rc(9," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c "),d.Kb(),d.Kb()}}var N=function(t){return{overdue:t}},G=function(t){return{turned:t}};function H(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-item",28),d.Tb("click",(function(){d.lc(e);var t=n.$implicit;return d.Vb(2).selectOrder(t.id)}))("longPress",(function(){return d.lc(e),d.Vb(2).vibr()}))("hold",(function(){return d.lc(e),d.Vb(2).vibr()}))("cdkDragStarted",(function(){return d.lc(e),d.Vb(2).vibr()})),d.Lb(1,"ion-label"),d.Lb(2,"div",29),d.Lb(3,"span"),d.Lb(4,"span",30),d.rc(5),d.Kb(),d.Lb(6,"span"),d.rc(7),d.Kb(),d.Kb(),d.Lb(8,"span",30),d.qc(9,z,3,5,"span",4),d.qc(10,E,3,5,"span",4),d.Kb(),d.Kb(),d.Lb(11,"div",31),d.rc(12),d.Kb(),d.Lb(13,"div",32),d.rc(14),d.Kb(),d.qc(15,A,10,0,"div",33),d.Kb(),d.Jb(16,"ion-icon",34),d.Lb(17,"div",35),d.Tb("click",(function(t){d.lc(e);var o=n.$implicit;return o.show=!o.show,t.stopPropagation()})),d.Jb(18,"ion-icon",36),d.Kb(),d.Kb()}if(2&t){var o=n.$implicit,i=d.Vb(2);d.cc("ngClass",d.fc(12,N,"1"==o.overdue||1==o.required))("cdkDragStartDelay",500)("cdkDragDisabled",i.noDrag),d.yb(1),d.cc("@openClose",o.show?"open":"closed"),d.yb(4),d.tc(" ",o.client_id,""),d.yb(2),d.tc(" (",o.company,")"),d.yb(2),d.cc("ngIf",o.datetime_from),d.yb(1),d.cc("ngIf",o.datetime_to),d.yb(2),d.sc(o.client_address),d.yb(2),d.sc(o.client_fio),d.yb(1),d.cc("ngIf",o.show),d.yb(3),d.cc("ngClass",d.fc(14,G,1==o.show))}}function F(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",24),d.Lb(1,"ion-searchbar",25),d.Tb("ionChange",(function(t){return d.lc(e),d.Vb().onSearchChange(t)}))("ngModelChange",(function(t){return d.lc(e),d.Vb().searchString=t})),d.Kb(),d.Lb(2,"cdk-virtual-scroll-viewport",26),d.Tb("cdkDropListDropped",(function(t){return d.lc(e),d.Vb().drop(t)})),d.qc(3,H,19,16,"ion-item",27),d.Wb(4,"async"),d.Kb(),d.Kb()}if(2&t){var o=d.Vb();d.yb(1),d.cc("debounce",250)("ngModel",o.searchString),d.yb(2),d.cc("ngForOf",d.Xb(4,3,o.orders_c))}}function B(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",48),d.Tb("click",(function(){return d.lc(e),d.Vb(2).startRoute()})),d.rc(1," \u041d\u0430\u0447\u0430\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442 "),d.Kb()}}function U(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",49),d.Tb("click",(function(){return d.lc(e),d.Vb(2).stopRoute()})),d.rc(1," \u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442 "),d.Kb()}}function X(t,n){1&t&&(d.Lb(0,"span"),d.rc(1,"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"),d.Kb())}function Z(t,n){1&t&&(d.Lb(0,"span"),d.rc(1,"\u0420\u0443\u0447\u043d\u043e\u0439 \u0440\u0435\u0436\u0438\u043c"),d.Kb())}var Q=function(t){return{manual_btn:t}};function Y(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",50),d.Tb("click",(function(){return d.lc(e),d.Vb(2).manualRoute()})),d.qc(1,X,2,0,"span",4),d.qc(2,Z,2,0,"span",4),d.Kb()}if(2&t){var o=d.Vb(2);d.cc("ngClass",d.fc(3,Q,o.state$.manual_route)),d.yb(1),d.cc("ngIf",o.state$.manual_route),d.yb(1),d.cc("ngIf",!o.state$.manual_route)}}function tt(t,n){if(1&t&&(d.Lb(0,"div",44),d.qc(1,B,2,0,"button",45),d.qc(2,U,2,0,"button",46),d.qc(3,Y,3,5,"button",47),d.Kb()),2&t){var e=d.Vb();d.yb(1),d.cc("ngIf",!e.btn_go&&!e.state$.manual_route&&e.auth.routingModeAuto),d.yb(1),d.cc("ngIf",e.btn_go&&!e.state$.manual_route),d.yb(1),d.cc("ngIf","auto"==e.auth.getMode()||"auto_wo"==e.auth.getMode())}}function nt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",51),d.Lb(1,"div",52),d.Lb(2,"div",53),d.rc(3,"\u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0439\u0442\u0435 \u0448\u0442\u0440\u0438\u0445\u043a\u043e\u0434"),d.Kb(),d.Lb(4,"input",54,55),d.Tb("change",(function(){return d.lc(e),d.Vb().scanInputChange()}))("ngModelChange",(function(t){return d.lc(e),d.Vb().scanInput=t})),d.Kb(),d.Kb(),d.Kb()}if(2&t){var o=d.Vb();d.yb(4),d.cc("ngModel",o.scanInput)}}function et(t,n){1&t&&(d.Lb(0,"div",56),d.Jb(1,"ion-spinner",57),d.Kb())}function ot(t,n){if(1&t&&(d.Lb(0,"ion-item"),d.Jb(1,"ion-radio",63),d.Lb(2,"ion-label"),d.rc(3),d.Kb(),d.Kb()),2&t){var e=n.$implicit;d.yb(1),d.dc("value",e),d.yb(2),d.sc(e)}}function it(t,n){if(1&t){var e=d.Mb();d.Lb(0,"ion-list"),d.Lb(1,"ion-radio-group",61),d.Tb("ngModelChange",(function(t){return d.lc(e),d.Vb(2).selectedPhone=t})),d.Lb(2,"ion-list-header"),d.Lb(3,"ion-label"),d.rc(4,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440"),d.Kb(),d.Kb(),d.qc(5,ot,4,2,"ion-item",62),d.Kb(),d.Kb()}if(2&t){var o=d.Vb(2);d.yb(1),d.cc("ngModel",o.selectedPhone),d.yb(4),d.cc("ngForOf",o.orderPhones)}}function rt(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",2),d.Tb("click",(function(){d.lc(e);var t=d.Vb(2);return t.phoneClick("phone",t.order)})),d.rc(1," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0441\u043e \u0441\u0432\u043e\u0435\u0433\u043e \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 "),d.Kb()}}function ct(t,n){if(1&t){var e=d.Mb();d.Lb(0,"button",2),d.Tb("click",(function(){d.lc(e);var t=d.Vb(2);return t.phoneClick("operator",t.order)})),d.rc(1," \u041f\u043e\u0437\u0432\u043e\u043d\u0438\u0442\u044c \u0447\u0435\u0440\u0435\u0437 ip-\u0448\u043b\u044e\u0437 "),d.Kb()}}function st(t,n){if(1&t){var e=d.Mb();d.Lb(0,"div",58),d.Lb(1,"div",59),d.Lb(2,"i-feather",60),d.Tb("click",(function(){d.lc(e);var t=d.Vb();return t.callWindow=!t.callWindow})),d.Kb(),d.qc(3,it,6,2,"ion-list",4),d.qc(4,rt,2,0,"button",8),d.qc(5,ct,2,0,"button",8),d.Kb(),d.Kb()}if(2&t){var o=d.Vb();d.yb(3),d.cc("ngIf",o.orderPhones.length>1),d.yb(1),d.cc("ngIf","robotPhone"==o.settings.rules.phoneMode||"phone"==o.settings.rules.phoneMode),d.yb(1),d.cc("ngIf","robotPhone"==o.settings.rules.phoneMode||"robot"==o.settings.rules.phoneMode)}}var at,ut=function(t){return{m_wrp:t}},bt=function(){return[]},lt=((at=function(){function n(e,o,i,r,c,s,a,u,b,l,d,h,g,f){t(this,n),this.courier=e,this.router=o,this.state$=i,this.auth=r,this.bs=c,this.vbr=s,this.settings=a,this.sys=u,this.data=b,this.popoverController=l,this.map=d,this.orderService=h,this.CL=g,this.network=f,this.orders=null,this.statuses=null,this.selectedTab=1,this.ordersInit=!1,this.loader=!1,this.local_stop$=new M.a,this.localcheck=!1,this.g_done=0,this.g_process=0,this.g_fail=0,this.lvl_ind={width:"0%"},this.btn_go=!1,this.notification=null,this.subBtnCond=!0,this.scanView=!1,this.scan_process=!1,this.find_order=!1,this.isWorkEnded=!1,this.searchString="",this.slicer=this.howSlice(),this.callWindow=!1,this.noDrag=!1;var p=this;this.initContent(),null!=this.state$.position.getValue()&&this.startRoute(!1),this.state$.state.pipe(Object(w.a)(this.local_stop$)).subscribe((function(t){"orders_init"==t&&p.initContent()})),this.initConditions(),this.ord=this.data.orders.asObservable(),this.prepareOrdersList()}return e(n,[{key:"initConditions",value:function(){switch(this.auth.getMode()){case"fullAuto":this.state$.confirmed||(this.subBtnCond=!0);break;case"auto":this.subBtnCond=!1;break;case"fullHand":this.state$.confirmed||(this.subBtnCond=!0);break;case"hand":this.subBtnCond=!1}}},{key:"ngAfterViewChecked",value:function(){var t=this;this.Drop_L.autoScrollDisabled=!1,this.DragItems.changes.subscribe((function(n){t.DragItems.forEach((function(t){t.dragStartDelay={touch:500,mouse:100}}))}))}},{key:"ngOnInit",value:function(){var t=this;this.settings.checkout=!!(this.settings.rules.storeCheckMode-0),this.auth.checkState=this.settings.checkout?"checked"+localStorage.check:"checkedOut","hand"==this.settings.rules.appMode&&(this.state$.manual_route=!0),this.settings.rules.appMode.toLowerCase().includes("auto")&&(this.noDrag=!0),this.data.orders.subscribe((function(n){t.courier.count_orders(n)}))}},{key:"scanInputStart",value:function(){var t=this;this.scanView=!this.scanView,this.loader=!0,"scan"==this.auth.getScanMode()?t.courier.findOrder(this.scanInput).subscribe((function(n){t.scanInput=null,"true"==n.success?t.courier.sumbitOrder(n.order_id).subscribe((function(n){console.log("courier_page sbo resp",n),n?t.submitOrder():t.scanView=!1,t.loader=!1})):(t.auth.showError(2),t.loader=!1,t.scanView=!1),t.state$.confirmed=!0,t.orders.forEach((function(n){"0"==n.confirm&&(t.state$.confirmed=!1)}))})):t.loader=!1,this.scan_process=!1}},{key:"scanInputChange",value:function(){console.log("inputData",this.scanInput);var t=this;if(this.scan_process)return!1;this.scan_process=!0,this.find_order?setTimeout((function(){t.scanSearch()}),1500):setTimeout((function(){t.scanInputStart()}),1500)}},{key:"submitOrder",value:function(){var t=this;if(console.log("SUBMIT_ORDER_CALL"),"scan"==this.auth.getScanMode())return this.scanView=!this.scanView,setTimeout((function(){t.sInput.nativeElement.focus()}),500),!1;this.bs.scan().then((function(n){console.log("SCAN_RETURN_DATA",n),""!=n.text?(t.loader=!0,t.courier.findOrder(n.text).subscribe((function(n){"true"==n.success?t.courier.sumbitOrder(n.order_id).subscribe((function(n){n&&t.submitOrder(),t.loader=!1})):(t.auth.showError(2),t.loader=!1),t.state$.confirmed=!0,t.orders.forEach((function(n){"0"==n.confirm&&(t.state$.confirmed=!1)}))}))):t.loader=!1}))}},{key:"ordersListChanged",value:function(t){this.orders=t;var n=new Array;t.forEach((function(t){1==Number(t.status_id)&&n.push(t.id)})),this.state$.old_way=n}},{key:"ngOnDestroy",value:function(){this.local_stop$.next(),this.state$.orders_page_check=!1}},{key:"manualRoute",value:function(){this.courier.changeRouteMode(this.state$.manual_route?"auto":"fullHand"),this.vbr.vibrate(300)}},{key:"initContent",value:function(){var t=this,n=this;this.state$.orders.subscribe((function(){t.orders=t.state$.orders_data,console.log("sys::init\u0421ontent orders",t.orders),t.statuses=[{id:4,status:"\u041d\u0435 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"},{id:5,status:"\u0414\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"},{id:6,status:"\u0427\u0430\u0441\u0442\u0438\u0447\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"}],t.ordersInit=!0,n.count_orders()}))}},{key:"getStatus",value:function(t){return this.courier.getStatus(t)}},{key:"selectOrder",value:function(t){this.router.navigate(["/order",t])}},{key:"tabSelect",value:function(t){this.selectedTab=t}},{key:"customTrackBy",value:function(t,n){return t}},{key:"getCondition",value:function(t){switch(this.selectedTab){case 1:if(1==t)return!0;break;case 2:if(5==t||6==t)return!0;break;case 3:if(4==t)return!0}return!1}},{key:"count_orders",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.courier.ordersInfo,n=0,e=0,o=0,i=0;i<t.length;i++)switch(String(t[i].status_id)){case"4":o++;break;case"5":case"6":n++;break;case"1":e++}this.g_done=n,this.g_process=e,this.g_fail=o}},{key:"startRoute",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=this;this.auth.checkAuth().subscribe((function(o){"true"==o.success&&e.sendStartRoute(o.sync_id,t,n)}))}},{key:"stopRoute",value:function(){this.startRoute(!1,!0)}},{key:"sendStartRoute",value:function(t,n,e){var o={cid:t,lt:this.state$.position.getValue().lt,lg:this.state$.position.getValue().lg};n&&(o.start="1"),e&&(o.stop="1");var i=this;this.auth.sendPost("geo/route_start.php",o).subscribe((function(t){1==t.success&&(i.btn_go=!0,"stop"==t.result&&(i.btn_go=!1))}))}},{key:"scanSearch",value:function(){var t=this;this.scanView=!this.scanView,this.loader=!0,"scan"==this.auth.getScanMode()?t.courier.findOrder(this.scanInput).subscribe((function(n){t.scanInput=null,"true"==n.success?t.selectOrder(n.order_id):t.auth.showError(2),t.loader=!1,t.scanView=!1})):t.loader=!1,this.scan_process=!1,this.find_order=!1}},{key:"findOrder",value:function(){var t=this;if("scan"==this.auth.getScanMode())return this.scanView=!this.scanView,this.find_order=!0,setTimeout((function(){t.sInput.nativeElement.focus()}),500),!1;this.bs.scan().then((function(n){t.courier.findOrder(n.text).subscribe((function(n){"true"==n.success?t.selectOrder(n.order_id):t.auth.showError(2)}))}))}},{key:"endWork",value:function(){var t=this;this.courier.endWork().subscribe((function(n){n.success&&(t.isWorkEnded=!0,t.sys.presentToast("\u0420\u0430\u0431\u043e\u0447\u0438\u0439 \u0434\u0435\u043d\u044c \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d","success"))}),(function(n){t.sys.presentToast("\u041e\u0448\u0438\u0431\u043a\u0430: "+n.message,"danger")}))}},{key:"doRefresh",value:function(t){this.data.getApiData().add(t.target.complete())}},{key:"segmentChanged",value:function(t){var n=[Number(t.target.value)];"5"==t.target.value&&n.push(6),this.prepareOrdersList(n)}},{key:"onSearchChange",value:function(t){this.searchString=t.target.value,this.prepareOrdersList()}},{key:"prepareOrdersList",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1];this.orders_c=this.ord.pipe(Object(y.a)((function(e){return e&&e.filter((function(t){return n.includes(Number(t.status_id))})).filter((function(n){return n.client_address.toLowerCase().includes(t.searchString.toLowerCase())||n.client_fio.toLowerCase().includes(t.searchString.toLowerCase())||n.client_id.toLowerCase().includes(t.searchString.toLowerCase())})).slice(t.slicer)})),Object(y.a)((function(n){return n.forEach((function(t){t.show=!1})),t.orders=n,n})))}},{key:"howSlice",value:function(){return"standart"===this.settings.rules.typeRoute?0:1}},{key:"popoverHelp",value:function(t){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.popoverController.create({component:x,event:t,translucent:!0,cssClass:"help"});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"showHelp",value:function(t){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.popoverHelp(t);case 2:n.sent.present();case 3:case"end":return n.stop()}}),n,this)})))}},{key:"showRoute",value:function(t){this.map.showRoute(t)}},{key:"drop",value:function(t){Object(s.d)(this.orders,t.previousIndex,t.currentIndex),this.data.rewriteOrders(this.orders),console.log("sys:: \u043c\u0430\u0441\u0441\u0438\u0432 \u0437\u0430\u043a\u0430\u0437\u043e\u0432 \u043f\u043e\u0441\u043b\u0435 \u043f\u0435\u0440\u0435\u0442\u0430\u0441\u043a\u0438\u0432\u0430\u043d\u0438\u044f: ",this.orders)}},{key:"popoverNote",value:function(t,n){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popoverController.create({component:K,event:t,translucent:!0,cssClass:"help",componentProps:{orderId:n}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"note",value:function(t,n){return Object(v.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popoverNote(t,n);case 2:e.sent.present();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"phoneClick",value:function(t,n){this.order=n,this.orderPhones=this.parsePhone(n.client_phone);var e=this.parsePhone(n.courier_phone)[0];switch(1==this.orderPhones.length&&(this.selectedPhone=this.orderPhones[0]),t){case"init":this.callWindow=!this.callWindow;break;case"phone":this.CL.callNumber(this.selectedPhone,!1).then((function(){})),this.callWindow=!1,this.order=void 0;break;case"operator":if("none"==this.network.type)return this.phoneClick("phone",n),!1;this.selectedPhone&&e&&(this.auth.sendPost("orders",{action:"send_phone",client_number:this.selectedPhone,cur_number:e}).subscribe((function(t){console.log("call_subs",t)})),this.auth.showError(9),this.callWindow=!1),this.order=void 0}}},{key:"parsePhone",value:function(t){var n=[];for(t=t.replace(/\D+/g,"");t.length>7;)t=this.normalizePhoneNumber(t),n.push(t.slice("",11)),t=t.slice(11);return n}},{key:"normalizePhoneNumber",value:function(t){return"8"!==t[0]&&"7"!==t[0]&&11!==t.length&&(t="8"+t),7!=t.length&&10!=t.length||(t="8"+t),"8"!==t[0]&&11==t.length&&(t="8"+t.slice(1)),t}},{key:"vibr",value:function(t){this.vbr.vibrate(200),console.log("sys:: *\u0412\u0438\u0431\u0438\u0440\u0430\u0446\u0438\u044f*")}}]),n}()).\u0275fac=function(t){return new(t||at)(d.Ib(S.a),d.Ib(g.g),d.Ib(T.a),d.Ib(V.a),d.Ib(_.a),d.Ib(O.a),d.Ib(D.a),d.Ib($.a),d.Ib(R.a),d.Ib(f.H),d.Ib(P.a),d.Ib(L.a),d.Ib(C.a),d.Ib(k.a))},at.\u0275cmp=d.Cb({type:at,selectors:[["app-courier"]],viewQuery:function(t,n){var e;1&t&&(d.vc(j,!0),d.vc(s.b,!0),d.vc(s.a,!0)),2&t&&(d.jc(e=d.Ub())&&(n.sInput=e.first),d.jc(e=d.Ub())&&(n.Drop_L=e.first),d.jc(e=d.Ub())&&(n.DragItems=e))},decls:34,vars:13,consts:[[1,"toolbar"],["slot","start"],[3,"click"],["name","search","slot","start"],[4,"ngIf"],["appLongPress","",3,"longPress"],["size","small","color","dark"],["slot","primary"],[3,"click",4,"ngIf"],["slot","icon-only","name","help-circle-outline"],["slot","fixed",3,"ionRefresh"],["pullingIcon","arrow-dropdown","pullingText","\u041f\u043e\u0442\u044f\u043d\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c","refreshingSpinner","bubbles","refreshingText","\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435..."],[1,"c-wrp",3,"ngClass"],["value","1",3,"ionChange"],["value","1"],["value","5"],["value","4"],["class","c-body",4,"ngIf"],["class","start-route",4,"ngIf"],["class","scanWindow",4,"ngIf"],["class","shirm",4,"ngIf"],["class","call-window",4,"ngIf"],["name","box"],["name","check-square"],[1,"c-body"],["placeholder","\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0430\u043c","inputmode","text","animated","",3,"debounce","ngModel","ionChange","ngModelChange"],["cdkDropList","","itemSize","50",2,"height","100%","width","100%","min-height","50vh",3,"cdkDropListDropped"],["appLongPress","","cdkDrag","",3,"ngClass","cdkDragStartDelay","cdkDragDisabled","click","longPress","hold","cdkDragStarted",4,"ngFor","ngForOf"],["appLongPress","","cdkDrag","",3,"ngClass","cdkDragStartDelay","cdkDragDisabled","click","longPress","hold","cdkDragStarted"],[1,"title"],[1,"client-id"],[1,"addr"],[1,"name"],["class","actions",4,"ngIf"],["name","ellipsis-vertical","slot","start"],[1,"actions-button",3,"click"],["src","../../../assets/actions-arrows.svg",3,"ngClass"],[1,"actions"],["fill","solid","size","default","id","note",3,"click"],["slot","start","name","document"],["fill","solid","size","default","id","route",3,"click"],["slot","start","name","location-outline"],["fill","solid","size","default","id","call",3,"click"],["slot","start","name","call-outline"],[1,"start-route"],["class","satrt-r-btn",3,"click",4,"ngIf"],["class","satrt-r-btn sr-stop",3,"click",4,"ngIf"],["class","satrt-r-btn find-o-btn",3,"ngClass","click",4,"ngIf"],[1,"satrt-r-btn",3,"click"],[1,"satrt-r-btn","sr-stop",3,"click"],[1,"satrt-r-btn","find-o-btn",3,"ngClass","click"],[1,"scanWindow"],[1,"sw-wrp"],[1,"sw-title"],["autofocus","",1,"ionInp",3,"ngModel","change","ngModelChange"],["sInput",""],[1,"shirm"],["name","lines-small"],[1,"call-window"],[1,"cw-body"],["name","x-square","size","large",3,"click"],["name","selectedPhone",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[3,"value"]],template:function(t,n){1&t&&(d.Lb(0,"ion-header"),d.Lb(1,"ion-toolbar",0),d.Lb(2,"ion-buttons",1),d.Lb(3,"ion-button",2),d.Tb("click",(function(){return n.findOrder()})),d.Jb(4,"i-feather",3),d.Kb(),d.qc(5,q,3,0,"ion-button",4),d.Kb(),d.Lb(6,"ion-title",5),d.Tb("longPress",(function(){return n.vibr()})),d.rc(7,"\u041c\u043e\u0438 \u0437\u0430\u043a\u0430\u0437\u044b"),d.Kb(),d.Lb(8,"ion-title",6),d.rc(9),d.Kb(),d.Lb(10,"ion-buttons",7),d.qc(11,J,2,0,"ion-button",8),d.qc(12,W,2,0,"ion-button",8),d.Lb(13,"ion-button",2),d.Tb("click",(function(t){return n.showHelp(t)})),d.Jb(14,"ion-icon",9),d.Kb(),d.Kb(),d.Kb(),d.Kb(),d.Lb(15,"ion-content"),d.Lb(16,"ion-refresher",10),d.Tb("ionRefresh",(function(t){return n.doRefresh(t)})),d.Jb(17,"ion-refresher-content",11),d.Kb(),d.Lb(18,"div",12),d.Lb(19,"ion-segment",13),d.Tb("ionChange",(function(t){return n.segmentChanged(t)})),d.Lb(20,"ion-segment-button",14),d.Lb(21,"ion-label"),d.rc(22,"\u0412 \u0440\u0430\u0431\u043e\u0442\u0435"),d.Kb(),d.Kb(),d.Lb(23,"ion-segment-button",15),d.Lb(24,"ion-label"),d.rc(25,"\u0414\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"),d.Kb(),d.Kb(),d.Lb(26,"ion-segment-button",16),d.Lb(27,"ion-label"),d.rc(28,"\u041d\u0435 \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e"),d.Kb(),d.Kb(),d.Kb(),d.qc(29,F,5,5,"div",17),d.qc(30,tt,4,3,"div",18),d.qc(31,nt,6,1,"div",19),d.Kb(),d.qc(32,et,2,0,"div",20),d.qc(33,st,6,3,"div",21),d.Kb()),2&t&&(d.yb(5),d.cc("ngIf",n.auth.getGuessMode()),d.yb(4),d.sc(n.state$.filial),d.yb(2),d.cc("ngIf",n.subBtnCond),d.yb(1),d.cc("ngIf",0==(null==n.courier.sortOrders?null:n.courier.sortOrders.g_process)&&!n.isWorkEnded),d.yb(6),d.cc("ngClass",d.fc(10,ut,"fullHand"==n.auth.getMode()||"hand"==n.auth.getMode())),d.yb(11),d.cc("ngIf",n.ordersInit&&!n.auth.getGuessMode()),d.yb(1),d.cc("ngIf",n.ordersInit&&n.state$.orders_data!=d.ec(12,bt)&&null!==n.state$.orders_data&&"checkedOut"==n.auth.checkState),d.yb(1),d.cc("ngIf",n.scanView),d.yb(1),d.cc("ngIf",n.loader),d.yb(1),d.cc("ngIf",n.callWindow))},directives:[f.j,f.C,f.f,f.e,I.a,u.l,f.B,f.k,f.h,f.s,f.t,u.j,f.w,f.J,f.x,f.n,f.v,f.K,h.f,h.g,a.c,a.a,s.b,u.k,f.m,s.a,h.a,f.y,f.o,f.r,f.p,f.q,f.I],pipes:[u.b,u.e],styles:["ion-chip[_ngcontent-%COMP%]{white-space:nowrap}.headbar-right-buttons[_ngcontent-%COMP%]{position:fixed;right:0;z-index:999999;top:0;display:flex}ion-toolbar[_ngcontent-%COMP%]{--min-height:30px}.toolbar[_ngcontent-%COMP%], ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{font-size:16px}ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:30px}ion-header[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:24px}.fether[_ngcontent-%COMP%]{height:16px}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]{--background:#e5f0f4;--border-style:solid;--border-width:0.5px;--color:#585454;--color-checked:#2b637e;--indicator-height:0}ion-segment[_ngcontent-%COMP%]   ion-segment-button[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{text-transform:none}ion-segment[_ngcontent-%COMP%]   ion-segment-button.segment-button-checked[_ngcontent-%COMP%]{border-bottom:#fff}ion-searchbar[_ngcontent-%COMP%]{--box-shadow:0 0 01px #000;padding-left:2px;padding-right:2px}ion-item[_ngcontent-%COMP%]{--border-color:#d6cfcf;--border-width:1px;--border-radius:2px;--padding-start:0;margin:0 2px 5px;--inner-border-width:0}ion-item[_ngcontent-%COMP%]   ion-reorder[_ngcontent-%COMP%]{margin:8px 2px 5px}ion-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-weight:700;font-size:14px}ion-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .client-id[_ngcontent-%COMP%]{color:#2b637e}ion-item[_ngcontent-%COMP%]   .addr[_ngcontent-%COMP%]{color:#585454;font-size:13px;white-space:pre-wrap;padding:5px 0}ion-item[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{color:#333;font-size:13px;font-weight:700}ion-item[_ngcontent-%COMP%]   .actions-button[_ngcontent-%COMP%]{background:#4ba7c5;box-shadow:-1px -1px 2px rgba(0,0,0,.05);border-radius:10px 0 2px;position:absolute;right:0;bottom:0;width:25px;height:35px;text-align:center}ion-item[_ngcontent-%COMP%]   .actions-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:50% 0;width:12px;height:12px}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{bottom:0}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--background:#2b637e;--border-radius:2px;font-size:12px;text-transform:none;--padding-bottom:7px;--padding-top:7px;--padding-start:7px;--padding-end:7px;font-family:Roboto;--box-shadow:none;margin-right:13px;margin-left:0}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-left:0}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   #note[_ngcontent-%COMP%]{--background:#c9e9fa;--color:#2b637e}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   #route[_ngcontent-%COMP%]{--background:#c9cbfa;--color:#533f69}ion-item[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   #call[_ngcontent-%COMP%]{--background:#d7f3dd;--color:#3a543b}ion-item[_ngcontent-%COMP%]:nth-child(odd){--background:#f6fdff}ion-reorder[_ngcontent-%COMP%]{margin:0}ion-item.overdue[_ngcontent-%COMP%]{--border-color:red;--inner-border-width:0}ion-item.overdue[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .client-id[_ngcontent-%COMP%]{color:red}.turned[_ngcontent-%COMP%]{transform:rotate(.5turn)}.c-body[_ngcontent-%COMP%], .c-wrp[_ngcontent-%COMP%]{height:100%}.call-window[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6)}.call-window[_ngcontent-%COMP%], .call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]{width:85%;flex-direction:column;background:#fff;border-radius:5px;position:relative}.call-window[_ngcontent-%COMP%]   .cw-body[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:none;height:44px;width:80%;box-shadow:0 0 .5px .5px #7cd5ff;border-radius:3px;margin:5px 0;text-transform:uppercase}"],data:{animation:[Object(m.j)("openClose",[Object(m.g)("open",Object(m.h)({height:"auto"})),Object(m.g)("closed",Object(m.h)({height:"max-content"})),Object(m.i)("open => closed",[Object(m.e)("0.5s")]),Object(m.i)("closed => open",[Object(m.e)("0.5s")])])]}}),at);Object(u.r)(l.a,"ru");var dt,ht=[{path:"",component:lt}],gt=((dt=function n(){t(this,n)}).\u0275mod=d.Gb({type:dt}),dt.\u0275inj=d.Fb({factory:function(t){return new(t||dt)},providers:[{provide:d.u,useFactory:function(){return"ru"}}],imports:[[p.a,u.c,h.b,s.c,f.D,a.e,g.i.forChild(ht)]]}),dt)}}])}();