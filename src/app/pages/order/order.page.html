<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title *ngIf='order'>{{order.client_id}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="order">
  <ion-list>
    <ion-item>
      <ion-label>
        <div class='flex'>
          <img src="../../../assets/a-b.svg">
          <div class='addresses'>
            Адрес отправителя:
            <p>{{order.company_address}}</p>
            Адрес получателя:
            <p>{{order.client_address}}</p>
          </div>
        </div>
        <div class='client-id'>
          Шифр: <span>{{order.client_id}} </span>
        </div>
      </ion-label>
    </ion-item>
    <ion-item class='datetime'>
      <ion-label>
        <div>
          Дата доставки:
          <p>
            <span>
              {{order.datetime_to | date: 'd.MM.yyyy'}}
            </span>
          </p>
        </div>
        <div class='time'>
          Время доставки:
          <p>
            После <span>{{order.datetime_from | date: 'H:mm'}}</span> До
            <span>{{order.datetime_to | date: 'H:mm'}}</span>
          </p>
        </div>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label>
        <div class='flex main-info'>
          <div>
            Имя: <span class='bold'>{{order.client_fio}} </span><br />
            Компания: <span class='bold'>{{order.client_name}} </span><br />
            Отдел: <span class='bold'>{{order.Podrazd}} </span>
          </div>
          <div>
            Робот прозвон:
            <div class="st_state" [ngClass]="{
              'status_done' : order.client_status_id == 1,
              'status_wait' : order.client_status_id == 2,
              'status_fail' : order.client_status_id == 3,
              'status_none' : order.client_status_id == 8,
              'cl-status-voice' : order.client_status_id == 4 }">
              {{order.client_status}}
            </div>
          </div>
          <div>
            Сумма с клиента:
            <div class='primary-color bold'>
              {{order.rur?.toLocaleString('ru') || 0}} р.
            </div>
          </div>
          <div>
            Количество / Вес
            <div class='primary-color bold'>{{order.amount}} шт. / {{order.mass}} кг</div>
          </div>
        </div>
        <ion-button class='call' expand='full' fill='solid' (click)="phoneClick('init')">
          Позвонить клиенту
        </ion-button>
      </ion-label>
    </ion-item>
    <ion-item class='yellow'>
      <ion-label>
        Статус: <span class='bold'>{{getStatus()}} </span>
      </ion-label>
    </ion-item>
    <ion-item *ngIf="order.poruch">
      <ion-label>
        Комментарий к заказу
        <div class='bold'>
          {{order.poruch}}
        </div>
      </ion-label>
    </ion-item>
    <ion-item>
      <ion-label [@openClose]="openCompany ? 'open' : 'closed'">
        Компания отправитель:
        <div class='bold'>
          {{order.company}}
        </div>
        <ion-card id="company-card">
          <ion-item class="ion-activated" *ngIf="order.Cname">
            <ion-label>
              <h3>Ответственное лицо</h3>
              {{order.Cname}}
            </ion-label>
          </ion-item>
          <ion-item class="ion-activated" *ngIf="order.Cadress">
            <ion-label>
              <h3>Адрес</h3>
              {{order.Cadress}}
            </ion-label>
          </ion-item>
          <ion-item class="ion-activated" *ngIf="order.Cphone">
            <ion-label>
              <h3>Основной телефон</h3>
              {{order.Cphone}}
            </ion-label>
          </ion-item>
          <ion-item class="ion-activated" *ngIf="order.Cphone_s">
            <ion-label>
              <h3>Дополнительный телефон</h3>
              {{order.Cphone_s}}
            </ion-label>
          </ion-item>
        </ion-card>
      </ion-label>
      <div class="actions-button" (click)="tapBlock()">
        <ion-icon src='../../../assets/actions-arrows.svg' [ngClass]="{turned: openCompany == true }"></ion-icon>
      </div>
    </ion-item>
    <ion-item id='note-item'>
      <ion-input placeholder='Введите заметку по заказу' [(ngModel)]="note"></ion-input>
      <ion-button (click)="saveNote()">
        <ion-icon slot="icon-only" name="save"></ion-icon>
      </ion-button>
    </ion-item>
  </ion-list>
  <div id='navigate-buttons'>
    <ion-button expand="block" fill="solid" shape="round" (click)="intentStart()" class='action'>
      Открыть в навигаторе
    </ion-button>
    <ion-button expand="block" fill="solid" shape="round" (click)="showRoute(order)" class='action'>
      Показать на карте
    </ion-button>
  </div>
  <div id='done-buttons' *ngIf="!(status_id == 5 || status_id == 6 || status_id == 4)">
    <ion-button expand="full" fill="solid" shape="round" id='light-purple-button' class='action'
      (click)="selectStatus(4); presentNotDeliveredModal()">
      <ion-icon slot="start" name="close"></ion-icon>
      Не доставлено
    </ion-button>
    <ion-button expand="full" fill="solid" shape="round" class='action light-blue-button'
      (click)="selectStatus(6); presentPartDeliveredModal()">
      <ion-icon slot="start" src='../../../assets/pie-chart.svg'></ion-icon>
      Частично доставлено
    </ion-button>
    <ion-button expand="full" fill="solid" shape="round" class='action light-green-button'
      (click)="selectStatus(5); presentDeliveredModal()">
      <ion-icon slot="start" name="checkmark-done"></ion-icon>
      Доставлено
    </ion-button>
  </div>
  <div id="call-window" *ngIf="callWindow">
    <div class="cw-body">
      <i-feather name="x-square" (click)="phoneClick('init')" size="large"></i-feather>
      <ion-list *ngIf="orderPhones.length > 1">
        <ion-radio-group name="selectedPhone" [(ngModel)]="selectedPhone">
          <ion-list-header>
            <ion-label>Выберите номер</ion-label>
          </ion-list-header>
          <ion-item *ngFor="let phone of orderPhones">
            <ion-radio value="{{phone}}"></ion-radio>
            <ion-label>{{phone}}</ion-label>
          </ion-item>
        </ion-radio-group>
      </ion-list>
      <button (click)="phoneClick('phone')"
        *ngIf="settings.rules.phoneMode == 'robotPhone' || settings.rules.phoneMode == 'phone' ">
        Позвонить со своего телефона
      </button>
      <button (click)="phoneClick('operator')"
        *ngIf="settings.rules.phoneMode == 'robotPhone' || settings.rules.phoneMode == 'robot' ">
        Позвонить через ip-шлюз
      </button>
    </div>
  </div>
</ion-content>